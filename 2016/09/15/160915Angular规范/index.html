<!doctype html>



  


<html class="theme-next mist use-motion">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






  <meta name="baidu-site-verification" content="U90mznE9hO">







  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">





<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Angular规范,Angular样式指南">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1">






<meta name="description" content="这个规范的目的是为构建Angular应用提供指导，当然更加重要的是让大家知道选择它的理由,当然, 也是为了督促自己能够好好用规范去编写可维护的代码，跟大家一起共勉！  如果你喜欢这个规范，请在Pluralsight看看Angular Patterns: Clean Code。">
<meta name="keywords" content="Angular规范,Angular样式指南">
<meta property="og:type" content="article">
<meta property="og:title" content="Angular规范">
<meta property="og:url" content="https://lsqy.tech/2016/09/15/160915Angular规范/index.html">
<meta property="og:site_name" content="lsqy&#39;blog">
<meta property="og:description" content="这个规范的目的是为构建Angular应用提供指导，当然更加重要的是让大家知道选择它的理由,当然, 也是为了督促自己能够好好用规范去编写可维护的代码，跟大家一起共勉！  如果你喜欢这个规范，请在Pluralsight看看Angular Patterns: Clean Code。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://oi2h9y4dd.qnssl.com/ng-clean-code-banner.png">
<meta property="og:image" content="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/above-the-fold-1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/above-the-fold-2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/modularity-2.png">
<meta property="og:image" content="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/modularity-1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/testing-tools.png">
<meta property="og:updated_time" content="2018-11-15T08:32:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Angular规范">
<meta name="twitter:description" content="这个规范的目的是为构建Angular应用提供指导，当然更加重要的是让大家知道选择它的理由,当然, 也是为了督促自己能够好好用规范去编写可维护的代码，跟大家一起共勉！  如果你喜欢这个规范，请在Pluralsight看看Angular Patterns: Clean Code。">
<meta name="twitter:image" content="https://oi2h9y4dd.qnssl.com/ng-clean-code-banner.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6279379794555569000,
      author: 'lsqy'
    }
  };
</script>


  <title> Angular规范 | lsqy'blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-86960661-2', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d5c4f7a84b7a0a0ec8504180f91f871d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <div style="display: none;">
    <script src="https://s6.cnzz.com/stat.php?id=1278671078&web_id=1278671078" type="text/javascript"></script>
  </div>





  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">lsqy'blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Stay Hungry, Stay Foolish!</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-heartbeat fa-fw"></i> <br>
            
            公益404
          </a>
        </li>
      
        
        <li class="menu-item menu-item-awesome">
          <a href="/awesome" rel="section">
            
              <i class="menu-item-icon fa fa-html5 fa-fw"></i> <br>
            
            优秀项目&文章
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Angular规范
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2016-09-15T22:07:26+08:00" content="2016-09-15">
              2016-09-15
            </time>
          </span>

          
            <span class="post-category">
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Angular/" itemprop="url" rel="index">
                    <span itemprop="name">Angular</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/15/160915Angular规范/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/15/160915Angular规范/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>这个规范的目的是为构建Angular应用提供指导，当然更加重要的是让大家知道选择它的理由,当然, 也是为了督促自己能够好好用规范去编写可维护的代码，跟大家一起共勉！</p>
<blockquote>
<p>如果你喜欢这个规范，请在Pluralsight看看<a href="http://jpapa.me/ngclean" target="_blank" rel="noopener">Angular Patterns: Clean Code</a>。</p>
</blockquote>
<p>  <img src="https://oi2h9y4dd.qnssl.com/ng-clean-code-banner.png" alt="Angular Patterns: Clean Code"><a id="more"></a></p>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#单一职责">单一职责</a></li>
<li><a href="#iife">IIFE</a></li>
<li><a href="#modules">Modules</a></li>
<li><a href="#controllers">Controllers</a></li>
<li><a href="#services">Services</a></li>
<li><a href="#factories">Factories</a></li>
<li><a href="#data-services">Data Services</a></li>
<li><a href="#directives">Directives</a></li>
<li><a href="#解决controller的promises">解决Controller的Promises</a></li>
<li><a href="#手动依赖注入">手动依赖注入</a></li>
<li><a href="#压缩和注释">压缩和注释</a></li>
<li><a href="#异常处理">异常处理</a></li>
<li><a href="#命名">命名</a></li>
<li><a href="#应用程序结构的lift准则">应用程序结构的LIFT准则</a></li>
<li><a href="#应用程序结构">应用程序结构</a></li>
<li><a href="#模块化">模块化</a></li>
<li><a href="#启动逻辑">启动逻辑</a></li>
<li><a href="#angular-包装服务">Angular $包装服务</a></li>
<li><a href="#测试">测试</a></li>
<li><a href="#动画">动画</a></li>
<li><a href="#注释">注释</a></li>
<li><a href="#js-hint">JSHint</a></li>
<li><a href="#jscs">JSCS</a></li>
<li><a href="#常量">常量</a></li>
<li><a href="#文件模板和片段">文件模板和片段</a></li>
<li><a href="#yeoman-generator">Yeoman Generator</a></li>
<li><a href="#路由">路由</a></li>
<li><a href="#任务自动化">任务自动化</a></li>
<li><a href="#filters">Filters</a></li>
<li><a href="#angularjs文档">Angular文档</a></li>
</ol>
<h2 id="1-单一职责"><a href="#1-单一职责" class="headerlink" title="1. 单一职责"></a>1. 单一职责</h2><h3 id="规则一"><a href="#规则一" class="headerlink" title="规则一"></a>规则一</h3><ul>
<li><p>一个文件只定义一个组件。</p>
<p>下面的例子在同一个文件中定义了一个<code>app</code>的module和它的一些依赖、一个controller和一个factory。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line">angular</span><br><span class="line">  .module(<span class="string">'app'</span>, [<span class="string">'ngRoute'</span>])</span><br><span class="line">  .controller(<span class="string">'SomeController'</span>, SomeController)</span><br><span class="line">  .factory(<span class="string">'someFactory'</span>, someFactory);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeController</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFactory</span>(<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p>推荐以下面的方式来做，把上面相同的组件分割成单独的文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// app.module.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>, [<span class="string">'ngRoute'</span>]);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// someController.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'SomeController'</span>, SomeController);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeController</span>(<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="comment">// someFactory.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .factory(<span class="string">'someFactory'</span>, someFactory);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">someFactory</span>(<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="2-IIFE"><a href="#2-IIFE" class="headerlink" title="2. IIFE"></a>2. IIFE</h2><h3 id="JavaScript闭包"><a href="#JavaScript闭包" class="headerlink" title="JavaScript闭包"></a>JavaScript闭包</h3><ul>
<li>把Angular组件包装到一个立即调用函数表达式中（IIFE）。</li>
</ul>
<p>  <em>为什么？</em>：把变量从全局作用域中删除了，这有助于防止变量和函数声明比预期在全局作用域中有更长的生命周期，也有助于避免变量冲突。</p>
<p>  <em>为什么？</em>：当你的代码为了发布而压缩了并且被合并到同一个文件中时，可能会有很多变量发生冲突，使用了IIFE（给每个文件提供了一个独立的作用域），你就不用担心这个了。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="comment">// logger.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .factory(<span class="string">'logger'</span>, logger);</span><br><span class="line"></span><br><span class="line"><span class="comment">// logger function会被当作一个全局变量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// storage.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .factory(<span class="string">'storage'</span>, storage);</span><br><span class="line"></span><br><span class="line"><span class="comment">// storage function会被当作一个全局变量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">storage</span>(<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 再也不存在全局变量了</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// logger.js</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line"></span><br><span class="line">    angular</span><br><span class="line">        .module(<span class="string">'app'</span>)</span><br><span class="line">        .factory(<span class="string">'logger'</span>, logger);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// storage.js</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line"></span><br><span class="line">    angular</span><br><span class="line">        .module(<span class="string">'app'</span>)</span><br><span class="line">        .factory(<span class="string">'storage'</span>, storage);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">storage</span>(<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<ul>
<li><p>注：为了简洁起见，本规范余下的示例中将会省略IIFE语法。</p>
</li>
<li><p>注：IIFE阻止了测试代码访问私有成员（正则表达式、helper函数等），这对于自身测试是非常友好的。然而你可以把这些私有成员暴露到可访问成员中进行测试，例如把私有成员（正则表达式、helper函数等）放到factory或是constant中。</p>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="3-Modules"><a href="#3-Modules" class="headerlink" title="3. Modules"></a>3. Modules</h2><h3 id="避免命名冲突"><a href="#避免命名冲突" class="headerlink" title="避免命名冲突"></a>避免命名冲突</h3><ul>
<li>每一个独立子模块使用唯一的命名约定。</li>
</ul>
<p>  <em>为什么</em>：避免冲突，每个模块也可以方便定义子模块。</p>
<h3 id="定义-aka-Setters"><a href="#定义-aka-Setters" class="headerlink" title="定义(aka Setters)"></a>定义(aka Setters)</h3><ul>
<li>不使用任何一个使用了setter语法的变量来定义modules。</li>
</ul>
<p>  <em>为什么?</em>：在一个文件只有一个组件的条件下，完全不需要为一个模块引入一个变量。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'app'</span>, [</span><br><span class="line">    <span class="string">'ngAnimate'</span>,</span><br><span class="line">    <span class="string">'ngRoute'</span>,</span><br><span class="line">    <span class="string">'app.shared'</span>,</span><br><span class="line">    <span class="string">'app.dashboard'</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<p>  你只需要用简单的setter语法来代替。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>, [</span><br><span class="line">      <span class="string">'ngAnimate'</span>,</span><br><span class="line">      <span class="string">'ngRoute'</span>,</span><br><span class="line">      <span class="string">'app.shared'</span>,</span><br><span class="line">      <span class="string">'app.dashboard'</span></span><br><span class="line">  ]);</span><br></pre></td></tr></table></figure>

<h3 id="Getters"><a href="#Getters" class="headerlink" title="Getters"></a>Getters</h3><ul>
<li>使用module的时候，避免直接用一个变量，而是使用getter的链式语法。</li>
</ul>
<p>  <em>为什么？</em>：这将产生更加易读的代码，并且可以避免变量冲突和泄漏。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'app'</span>);</span><br><span class="line">app.controller(<span class="string">'SomeController'</span>, SomeController);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeController</span>(<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'SomeController'</span>, SomeController);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeController</span>(<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Setting-vs-Getting"><a href="#Setting-vs-Getting" class="headerlink" title="Setting vs Getting"></a>Setting vs Getting</h3><ul>
<li>只能设置一次。</li>
</ul>
<p>  <em>为什么？</em>：一个module只能被创建一次，创建之后才能被检索到。</p>
<pre><code>- 设置module，`angular.module(&apos;app&apos;, []);`。
- 获取module，`angular.module(&apos;app&apos;);`。</code></pre><h3 id="命名函数-vs-匿名函数"><a href="#命名函数-vs-匿名函数" class="headerlink" title="命名函数 vs 匿名函数"></a>命名函数 vs 匿名函数</h3><ul>
<li>回调函数使用命名函数，不要用匿名函数。</li>
</ul>
<p>  <em>为什么？</em>：易读，方便调试，减少嵌套回调函数的数量。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Dashboard'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;)</span><br><span class="line">    .factory(<span class="string">'logger'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;);</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// dashboard.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Dashboard'</span>, Dashboard);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dashboard</span> (<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// logger.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .factory(<span class="string">'logger'</span>, logger);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span> (<span class="params"></span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#目录">回到顶部</a></strong></p>
<h2 id="4-Controllers"><a href="#4-Controllers" class="headerlink" title="4. Controllers"></a>4. Controllers</h2><h3 id="controllerAs在View中的语法"><a href="#controllerAs在View中的语法" class="headerlink" title="controllerAs在View中的语法"></a>controllerAs在View中的语法</h3><ul>
<li>使用<a href="http://www.johnpapa.net/do-you-like-your-angular-controllers-with-or-without-sugar/" target="_blank" rel="noopener"><code>controllerAs</code></a> 语法代替直接用经典的$scope定义的controller的方式。</li>
</ul>
<p>  <em>为什么？</em>：controller被构建的时候，就会有一个新的实例，<code>controllerAs</code> 的语法比<code>经典的$scope语法</code>更接近JavaScript构造函数。</p>
<p>  <em>为什么？</em>：这促进在View中对绑定到“有修饰”的对象的使用（例如用<code>customer.name</code> 代替<code>name</code>），这将更有语境、更容易阅读，也避免了任何没有“修饰”而产生的引用问题。</p>
<p>  <em>为什么？</em>：有助于避免在有嵌套的controllers的Views中调用 <code>$parent</code>。</p>
  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- avoid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"Customer"</span>&gt;</span></span><br><span class="line">  &#123;&#123; name &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

  <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- recommended --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"Customer as customer"</span>&gt;</span></span><br><span class="line">  &#123;&#123; customer.name &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="controllerAs在controller中的语法"><a href="#controllerAs在controller中的语法" class="headerlink" title="controllerAs在controller中的语法"></a>controllerAs在controller中的语法</h3><ul>
<li><p>使用 <code>controllerAs</code> 语法代替 <code>经典的$scope语法</code> 语法。</p>
</li>
<li><p>使用<code>controllerAs</code> 时，controller中的<code>$scope</code>被绑定到了<code>this</code>上。</p>
</li>
</ul>
<p>  <em>为什么？</em>：<code>controllerAs</code> 是<code>$scope</code>的语法修饰，你仍然可以绑定到View上并且访问 <code>$scope</code>的方法。</p>
<p>  <em>为什么？</em>：避免在controller中使用 <code>$scope</code>，最好不用它们或是把它们移到一个factory中。factory中可以考虑使用<code>$scope</code>，controller中只在需要时候才使用<code>$scope</code>，例如当使用<a href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$emit" target="_blank" rel="noopener"><code>$emit</code></a>， <a href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$broadcast" target="_blank" rel="noopener"><code>$broadcast</code></a>，或者 <a href="https://docs.angularjs.org/api/ng/type/$rootScope.Scope#$on" target="_blank" rel="noopener"><code>$on</code></a>。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Customer</span> (<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">    $scope.name = &#123;&#125;;</span><br><span class="line">    $scope.sendMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended - but see next section */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Customer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.sendMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="controllerAs-with-vm"><a href="#controllerAs-with-vm" class="headerlink" title="controllerAs with vm"></a>controllerAs with vm</h3><ul>
<li>使用<code>controllerAs</code>语法时把<code>this</code> 赋值给一个可捕获的变量，选择一个有代表性的名称，例如<code>vm</code>代表ViewModel。</li>
</ul>
<p>  <em>为什么？</em>：<code>this</code>在不同的地方有不同的语义（就是作用域不同），在controller中的一个函数内部使用<code>this</code>时可能会改变它的上下文。用一个变量来捕获<code>this</code>的上下文从而可以避免遇到这样的坑。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Customer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.sendMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Customer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.name = &#123;&#125;;</span><br><span class="line">    vm.sendMessage = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>注：你可以参照下面的做法来避免 <a href="http://www.jshint.com/" target="_blank" rel="noopener">jshint</a>的警告。但是构造函数（函数名首字母大写）是不需要这个的.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* jshint validthis: true */</span></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>注：在controller中用<code>controller as</code>创建了一个watch时，可以用下面的语法监测<code>vm.*</code>的成员。（创建watch时要谨慎，因为它会增加更多的负载）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"vm.title"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SomeController</span>(<span class="params">$scope, $log</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.title = <span class="string">'Some Title'</span>;</span><br><span class="line"></span><br><span class="line">    $scope.$watch(<span class="string">'vm.title'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">current, original</span>) </span>&#123;</span><br><span class="line">        $log.info(<span class="string">'vm.title was %s'</span>, original);</span><br><span class="line">        $log.info(<span class="string">'vm.title is now %s'</span>, current);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="置顶绑定成员"><a href="#置顶绑定成员" class="headerlink" title="置顶绑定成员"></a>置顶绑定成员</h3><ul>
<li>把可绑定的成员放到controller的顶部，按字母排序，并且不要通过controller的代码传播。</li>
</ul>
<p>  <em>为什么？</em>：虽然设置单行匿名函数很容易，但是当这些函数的代码超过一行时，这将极大降低代码的可读性。在可绑定成员下面定义函数（这些函数被提出来），把具体的实现细节放到下面，可绑定成员置顶，这会提高代码的可读性。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sessions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    vm.gotoSession = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* ... */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    vm.refresh = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* ... */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    vm.search = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* ... */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    vm.sessions = [];</span><br><span class="line">    vm.title = <span class="string">'Sessions'</span>;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sessions</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    vm.gotoSession = gotoSession;</span><br><span class="line">    vm.refresh = refresh;</span><br><span class="line">    vm.search = search;</span><br><span class="line">    vm.sessions = [];</span><br><span class="line">    vm.title = <span class="string">'Sessions'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gotoSession</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">refresh</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">search</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>  <img src="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/above-the-fold-1.png" alt="Controller Using &quot;Above the Fold&quot;"></p>
<p>  注：如果一个函数就是一行，那么只要不影响可读性就把它放到顶部。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sessions</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    vm.gotoSession = gotoSession;</span><br><span class="line">    vm.refresh = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * lines</span></span><br><span class="line"><span class="comment">         * of</span></span><br><span class="line"><span class="comment">         * code</span></span><br><span class="line"><span class="comment">         * affects</span></span><br><span class="line"><span class="comment">         * readability</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    vm.search = search;</span><br><span class="line">    vm.sessions = [];</span><br><span class="line">    vm.title = <span class="string">'Sessions'</span>;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sessions</span>(<span class="params">dataservice</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    vm.gotoSession = gotoSession;</span><br><span class="line">    vm.refresh = dataservice.refresh; <span class="comment">// 1 liner is OK</span></span><br><span class="line">    vm.search = search;</span><br><span class="line">    vm.sessions = [];</span><br><span class="line">    vm.title = <span class="string">'Sessions'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="函数声明隐藏实现细节"><a href="#函数声明隐藏实现细节" class="headerlink" title="函数声明隐藏实现细节"></a>函数声明隐藏实现细节</h3><ul>
<li>使用函数声明来隐藏实现细节，置顶绑定成员，当你需要在controller中绑定一个函数时，把它指向一个在文件的后面会出现函数声明。更多详情请看<a href="http://www.johnpapa.net/angular-function-declarations-function-expressions-and-readable-code" target="_blank" rel="noopener">这里</a>。</li>
</ul>
<p>  <em>为什么？</em>：易读，易识别哪些成员可以在View中绑定和使用。</p>
<p>  <em>为什么？</em>：把函数的实现细节放到后面，你可以更清楚地看到重要的东西。</p>
<p>  <em>为什么？</em>：由于函数声明会被置顶，所以没有必要担心在声明它之前就使用函数的问题。</p>
<p>  <em>为什么？</em>：你再也不用担心当 <code>a</code>依赖于 <code>b</code>时，把<code>var a</code>放到<code>var b</code>之前会中断你的代码的函数声明问题。</p>
<p>  <em>为什么？</em>：函数表达式中顺序是至关重要的。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * avoid</span></span><br><span class="line"><span class="comment"> * Using function expressions.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span>(<span class="params">dataservice, logger</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.avengers = [];</span><br><span class="line">    vm.title = <span class="string">'Avengers'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> activate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            logger.info(<span class="string">'Activated Avengers View'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getAvengers = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataservice.getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            vm.avengers = data;</span><br><span class="line">            <span class="keyword">return</span> vm.avengers;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vm.getAvengers = getAvengers;</span><br><span class="line"></span><br><span class="line">    activate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  注意这里重要的代码分散在前面的例子中。<br>  下面的示例中，可以看到重要的代码都放到了顶部。实现的详细细节都在下方，显然这样的代码更易读。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * recommend</span></span><br><span class="line"><span class="comment"> * Using function declarations</span></span><br><span class="line"><span class="comment"> * and bindable members up top.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span>(<span class="params">dataservice, logger</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.avengers = [];</span><br><span class="line">    vm.getAvengers = getAvengers;</span><br><span class="line">    vm.title = <span class="string">'Avengers'</span>;</span><br><span class="line"></span><br><span class="line">    activate();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            logger.info(<span class="string">'Activated Avengers View'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAvengers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataservice.getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            vm.avengers = data;</span><br><span class="line">            <span class="keyword">return</span> vm.avengers;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="把Controller中的逻辑延迟到Service中"><a href="#把Controller中的逻辑延迟到Service中" class="headerlink" title="把Controller中的逻辑延迟到Service中"></a>把Controller中的逻辑延迟到Service中</h3><ul>
<li>通过委派到service和factory中来延迟controller中的逻辑。</li>
</ul>
<p>  <em>为什么？</em>：把逻辑放到service中，并通过一个function暴露，就可以被多个controller重用。</p>
<p>  <em>为什么？</em>：把逻辑放到service中将会使单元测试的时候更加容易地把它们分离，相反，如果在controller中调用逻辑就显得很二了。</p>
<p>  <em>为什么？</em>：保持controller的简洁。</p>
<p>  <em>为什么？</em>：从controller中删除依赖关系并且隐藏实现细节。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Order</span>(<span class="params">$http, $q, config, userInfo</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.checkCredit = checkCredit;</span><br><span class="line">    vm.isCreditOk;</span><br><span class="line">    vm.total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkCredit</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> settings = &#123;&#125;;</span><br><span class="line">        <span class="comment">// Get the credit service base URL from config</span></span><br><span class="line">        <span class="comment">// Set credit service required headers</span></span><br><span class="line">        <span class="comment">// Prepare URL query string or data object with request data</span></span><br><span class="line">        <span class="comment">// Add user-identifying info so service gets the right credit limit for this user.</span></span><br><span class="line">        <span class="comment">// Use JSONP for this browser if it doesn't support CORS</span></span><br><span class="line">        <span class="keyword">return</span> $http.get(settings)</span><br><span class="line">            .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">               <span class="comment">// Unpack JSON data in the response object</span></span><br><span class="line">               <span class="comment">// to find maxRemainingAmount</span></span><br><span class="line">               vm.isCreditOk = vm.total &lt;= maxRemainingAmount</span><br><span class="line">            &#125;)</span><br><span class="line">            .catch(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">               <span class="comment">// Interpret error</span></span><br><span class="line">               <span class="comment">// Cope w/ timeout? retry? try alternate service?</span></span><br><span class="line">               <span class="comment">// Re-reject with appropriate error for a user to see</span></span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Order</span> (<span class="params">creditService</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.checkCredit = checkCredit;</span><br><span class="line">    vm.isCreditOk;</span><br><span class="line">    vm.total = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">checkCredit</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> creditService.isOrderTotalOk(vm.total)</span><br><span class="line">          .then(<span class="function"><span class="keyword">function</span>(<span class="params">isOk</span>) </span>&#123; vm.isCreditOk = isOk; &#125;)</span><br><span class="line">          .catch(showServiceError);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="保持Controller的专一性"><a href="#保持Controller的专一性" class="headerlink" title="保持Controller的专一性"></a>保持Controller的专一性</h3><ul>
<li><p>一个view定义一个controller，尽量不要在其它view中使用这个controller。把可重用的逻辑放到factory中，保证controller只服务于当前视图。</p>
<p><em>为什么？</em>：不同的view用同一个controller是非常不科学的，良好的端对端测试覆盖率对于保证大型应用稳定性是必需的。</p>
</li>
</ul>
<h3 id="分配Controller"><a href="#分配Controller" class="headerlink" title="分配Controller"></a>分配Controller</h3><ul>
<li><p>当一个controller必须匹配一个view时或者任何一个组件可能被其它controller或是view重用时，连同controller的route一起定义。</p>
<p>注：如果一个view是通过route外的其它形式加载的，那么就用<code>ng-controller=&quot;Avengers as vm&quot;</code>语法。</p>
<p><em>为什么？</em>：在route中匹配controller允许不同的路由调用不同的相匹配的controller和view，当在view中通过<a href="https://docs.angularjs.org/api/ng/directive/ngController" target="_blank" rel="noopener"><code>ng-controller</code></a>分配controller时，这个view总是和相同的controller相关联。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid - when using with a route and dynamic pairing is desired */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// route-config.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .config(config);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span> (<span class="params">$routeProvider</span>) </span>&#123;</span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">'/avengers'</span>, &#123;</span><br><span class="line">            templateUrl: <span class="string">'avengers.html'</span></span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- avengers.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-controller</span>=<span class="string">"Avengers as vm"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// route-config.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .config(config);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span> (<span class="params">$routeProvider</span>) </span>&#123;</span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">'/avengers'</span>, &#123;</span><br><span class="line">            templateUrl: <span class="string">'avengers.html'</span>,</span><br><span class="line">            controller: <span class="string">'Avengers'</span>,</span><br><span class="line">            controllerAs: <span class="string">'vm'</span></span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- avengers.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="5-Services"><a href="#5-Services" class="headerlink" title="5. Services"></a>5. Services</h2><h3 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h3><ul>
<li><p>用<code>new</code>实例化service，用<code>this</code>实例化公共方法和变量，由于这和factory是类似的，所以为了保持统一，推荐用facotry来代替。</p>
<p>注意：<a href="https://docs.angularjs.org/guide/services" target="_blank" rel="noopener">所有的Angular services都是单例</a>，这意味着每个injector都只有一个实例化的service。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// service</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .service(<span class="string">'logger'</span>, logger);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.logError = <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// factory</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .factory(<span class="string">'logger'</span>, logger);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        logError: <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">          <span class="comment">/* */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="6-Factories"><a href="#6-Factories" class="headerlink" title="6. Factories"></a>6. Factories</h2><h3 id="单一职责"><a href="#单一职责" class="headerlink" title="单一职责"></a>单一职责</h3><ul>
<li>factory应该是<a href="http://en.wikipedia.org/wiki/Single_responsibility_principle" target="_blank" rel="noopener">单一职责</a>，这是由其上下文进行封装的。一旦一个factory将要处理超过单一的目的时，就应该创建一个新的factory。</li>
</ul>
<h3 id="单例-1"><a href="#单例-1" class="headerlink" title="单例"></a>单例</h3><ul>
<li><p>facotry是一个单例，它返回一个包含service成员的对象。</p>
<p>注：<a href="https://docs.angularjs.org/guide/services" target="_blank" rel="noopener">所有的Angular services都是单例</a>，这意味着每个injector都只有一个实例化的service。</p>
</li>
</ul>
<h3 id="可访问的成员置顶"><a href="#可访问的成员置顶" class="headerlink" title="可访问的成员置顶"></a>可访问的成员置顶</h3><ul>
<li><p>使用从<a href="http://addyosmani.com/resources/essentialjsdesignpatterns/book/#revealingmodulepatternjavascript" target="_blank" rel="noopener">显露模块模式</a>派生出来的技术把service（它的接口）中可调用的成员暴露到顶部，</p>
<p><em>为什么？</em>：易读，并且让你可以立即识别service中的哪些成员可以被调用，哪些成员必须进行单元测试（或者被别人嘲笑）。</p>
<p><em>为什么？</em>：当文件内容很长时，这可以避免需要滚动才能看到暴露了哪些东西。</p>
<p><em>为什么？</em>：虽然你可以随意写一个函数，但当函数代码超过一行时就会降低可读性并造成滚动。通过把实现细节放下面、把可调用接口置顶的形式返回service的方式来定义可调用的接口，从而使代码更加易读。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataService</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> someValue = <span class="string">''</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">save</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">validate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        save: save,</span><br><span class="line">        someValue: someValue,</span><br><span class="line">        validate: validate</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataService</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> someValue = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">var</span> service = &#123;</span><br><span class="line">        save: save,</span><br><span class="line">        someValue: someValue,</span><br><span class="line">        validate: validate</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">save</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">validate</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种绑定方式复制了宿主对象，原始值不会随着暴露模块模式的使用而更新。</p>
<p><img src="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/above-the-fold-2.png" alt="Factories Using &quot;Above the Fold&quot;"></p>
</li>
</ul>
<h3 id="函数声明隐藏实现细节-1"><a href="#函数声明隐藏实现细节-1" class="headerlink" title="函数声明隐藏实现细节"></a>函数声明隐藏实现细节</h3><ul>
<li><p>函数声明隐藏实现细节，置顶绑定成员，当你需要在controller中绑定一个函数时，把它指向一个函数声明，这个函数声明在文件的后面会出现。</p>
<p><em>为什么？</em>：易读，易识别哪些成员可以在View中绑定和使用。</p>
<p><em>为什么？</em>：把函数的实现细节放到后面，你可以更清楚地看到重要的东西。</p>
<p><em>为什么？</em>：由于函数声明会被置顶，所以没有必要担心在声明它之前就使用函数的问题。</p>
<p><em>为什么？</em>：你再也不用担心当 <code>a</code>依赖于 <code>b</code>时，把<code>var a</code>放到<code>var b</code>之前会中断你的代码的函数声明问题。</p>
<p><em>为什么？</em>：函数表达式中顺序是至关重要的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * avoid</span></span><br><span class="line"><span class="comment"> * Using function expressions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">dataservice</span>(<span class="params">$http, $location, $q, exception, logger</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> isPrimed = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> primePromise;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getAvengers = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getAvengerCount = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> getAvengersCast = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> prime = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ready = <span class="function"><span class="keyword">function</span>(<span class="params">nextPromises</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> service = &#123;</span><br><span class="line">        getAvengersCast: getAvengersCast,</span><br><span class="line">        getAvengerCount: getAvengerCount,</span><br><span class="line">        getAvengers: getAvengers,</span><br><span class="line">        ready: ready</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> service;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> * Using function declarations</span></span><br><span class="line"><span class="comment"> * and accessible members up top.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataservice</span>(<span class="params">$http, $location, $q, exception, logger</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> isPrimed = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">var</span> primePromise;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> service = &#123;</span><br><span class="line">        getAvengersCast: getAvengersCast,</span><br><span class="line">        getAvengerCount: getAvengerCount,</span><br><span class="line">        getAvengers: getAvengers,</span><br><span class="line">        ready: ready</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> service;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAvengers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAvengerCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAvengersCast</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">prime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ready</span>(<span class="params">nextPromises</span>) </span>&#123;</span><br><span class="line">      <span class="comment">// implementation details go here</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="7-Data-Services"><a href="#7-Data-Services" class="headerlink" title="7. Data Services"></a>7. Data Services</h2><h3 id="独立的数据调用"><a href="#独立的数据调用" class="headerlink" title="独立的数据调用"></a>独立的数据调用</h3><ul>
<li><p>把进行数据操作和数据交互的逻辑放到factory中，数据服务负责XHR请求、本地存储、内存存储和其它任何数据操作。</p>
<p><em>为什么？</em>：controller的作用是查看视图和收集视图的信息，它不应该关心如何取得数据，只需要知道哪里需要用到数据。把取数据的逻辑放到数据服务中能够让controller更简单、更专注于对view的控制。</p>
<p><em>为什么？</em>：方便测试。</p>
<p><em>为什么？</em>：数据服务的实现可能有非常明确的代码来处理数据仓库，这可能包含headers、如何与数据交互或是其它service，例如<code>$http</code>。把逻辑封装到单独的数据服务中，这隐藏了外部调用者（例如controller）对数据的直接操作，这样更加容易执行变更。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// dataservice factory</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.core'</span>)</span><br><span class="line">    .factory(<span class="string">'dataservice'</span>, dataservice);</span><br><span class="line"></span><br><span class="line">dataservice.$inject = [<span class="string">'$http'</span>, <span class="string">'logger'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dataservice</span>(<span class="params">$http, logger</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        getAvengers: getAvengers</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAvengers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $http.get(<span class="string">'/api/maa'</span>)</span><br><span class="line">            .then(getAvengersComplete)</span><br><span class="line">            .catch(getAvengersFailed);</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getAvengersComplete</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> response.data.results;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getAvengersFailed</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">            logger.error(<span class="string">'XHR Failed for getAvengers.'</span> + error.data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：数据服务被调用时（例如controller），隐藏调用的直接行为，如下所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// controller calling the dataservice factory</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.avengers'</span>)</span><br><span class="line">    .controller(<span class="string">'Avengers'</span>, Avengers);</span><br><span class="line"></span><br><span class="line">Avengers.$inject = [<span class="string">'dataservice'</span>, <span class="string">'logger'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span>(<span class="params">dataservice, logger</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.avengers = [];</span><br><span class="line"></span><br><span class="line">    activate();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            logger.info(<span class="string">'Activated Avengers View'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getAvengers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataservice.getAvengers()</span><br><span class="line">          .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">              vm.avengers = data;</span><br><span class="line">              <span class="keyword">return</span> vm.avengers;</span><br><span class="line">          &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="数据调用返回一个Promise"><a href="#数据调用返回一个Promise" class="headerlink" title="数据调用返回一个Promise"></a>数据调用返回一个Promise</h3><ul>
<li><p>就像<code>$http</code>一样，调用数据时返回一个promise，在你的调用函数中也返回一个promise。</p>
<p><em>为什么？</em>：你可以把promise链接到一起，在数据调用完成并且resolve或是reject这个promise后采取进一步的行为。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"></span><br><span class="line">activate();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Step 1</span></span><br><span class="line"><span class="comment">     * Ask the getAvengers function for the</span></span><br><span class="line"><span class="comment">     * avenger data and wait for the promise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * Step 4</span></span><br><span class="line"><span class="comment">       * Perform an action on resolve of final promise</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      logger.info(<span class="string">'Activated Avengers View'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAvengers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Step 2</span></span><br><span class="line"><span class="comment">     * Ask the data service for the data and wait</span></span><br><span class="line"><span class="comment">     * for the promise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> dataservice.getAvengers()</span><br><span class="line">      .then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">          <span class="comment">/**</span></span><br><span class="line"><span class="comment">           * Step 3</span></span><br><span class="line"><span class="comment">           * set the data and resolve the promise</span></span><br><span class="line"><span class="comment">           */</span></span><br><span class="line">          vm.avengers = data;</span><br><span class="line">          <span class="keyword">return</span> vm.avengers;</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="8-Directives"><a href="#8-Directives" class="headerlink" title="8. Directives"></a>8. Directives</h2><h3 id="一个directive一个文件"><a href="#一个directive一个文件" class="headerlink" title="一个directive一个文件"></a>一个directive一个文件</h3><ul>
<li><p>一个文件中只创建一个directive，并依照directive来命名文件。</p>
<p><em>为什么？</em>：虽然把所有directive放到一个文件中很简单，但是当一些directive是跨应用的，一些是跨模块的，一些仅仅在一个模块中使用时，想把它们独立出来就非常困难了。</p>
<p><em>为什么？</em>：一个文件一个directive也更加容易维护。</p>
<blockquote>
<p>注： “<strong>最佳实践</strong>：Angular文档中有提过，directive应该自动回收，当directive被移除后，你可以使用<code>element.on(&#39;$destroy&#39;, ...)</code>或者<code>scope.$on(&#39;$destroy&#39;, ...)</code>来执行一个clean-up函数。”</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="comment">/* directives.js */</span></span><br><span class="line"></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.widgets'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* order directive仅仅会被order module用到 */</span></span><br><span class="line">    .directive(<span class="string">'orderCalendarRange'</span>, orderCalendarRange)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* sales directive可以在sales app的任意地方使用 */</span></span><br><span class="line">    .directive(<span class="string">'salesCustomerInfo'</span>, salesCustomerInfo)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* spinner directive可以在任意apps中使用 */</span></span><br><span class="line">    .directive(<span class="string">'sharedSpinner'</span>, sharedSpinner);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">orderCalendarRange</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* implementation details */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">salesCustomerInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* implementation details */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sharedSpinner</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* implementation details */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="comment">/* calendarRange.directive.js */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc </span>order directive that is specific to the order module at a company named Acme</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>&lt;div acme-order-calendar-range&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'sales.order'</span>)</span><br><span class="line">    .directive(<span class="string">'acmeOrderCalendarRange'</span>, orderCalendarRange);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">orderCalendarRange</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* implementation details */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="comment">/* customerInfo.directive.js */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc </span>sales directive that can be used anywhere across the sales app at a company named Acme</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>&lt;div acme-sales-customer-info&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'sales.widgets'</span>)</span><br><span class="line">    .directive(<span class="string">'acmeSalesCustomerInfo'</span>, salesCustomerInfo);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">salesCustomerInfo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* implementation details */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="comment">/* spinner.directive.js */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc </span>spinner directive that can be used anywhere across apps at a company named Acme</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example </span>&lt;div acme-shared-spinner&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'shared.widgets'</span>)</span><br><span class="line">    .directive(<span class="string">'acmeSharedSpinner'</span>, sharedSpinner);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sharedSpinner</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* implementation details */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注：由于directive使用条件比较广，所以命名就存在很多的选项。选择一个让directive和它的文件名都清楚分明的名字。下面有一些例子，不过更多的建议去看<a href="#命名">命名</a>章节。</p>
</li>
</ul>
<h3 id="在directive中操作DOM"><a href="#在directive中操作DOM" class="headerlink" title="在directive中操作DOM"></a>在directive中操作DOM</h3><ul>
<li><p>当需要直接操作DOM的时候，使用directive。如果有替代方法可以使用，例如：使用CSS来设置样式、<a href="https://docs.angularjs.org/api/ngAnimate" target="_blank" rel="noopener">animation services</a>、Angular模板、<a href="https://docs.angularjs.org/api/ng/directive/ngShow" target="_blank" rel="noopener"><code>ngShow</code></a>或者<a href="https://docs.angularjs.org/api/ng/directive/ngHide" target="_blank" rel="noopener"><code>ngHide</code></a>，那么就直接用这些即可。例如，如果一个directive只是想控制显示和隐藏，用ngHide/ngShow即可。</p>
<p><em>为什么？</em>：DOM操作的测试和调试是很困难的，通常会有更好的方法（CSS、animations、templates）。</p>
</li>
</ul>
<h3 id="提供一个唯一的Directive前缀"><a href="#提供一个唯一的Directive前缀" class="headerlink" title="提供一个唯一的Directive前缀"></a>提供一个唯一的Directive前缀</h3><ul>
<li><p>提供一个短小、唯一、具有描述性的directive前缀，例如<code>acmeSalesCustomerInfo</code>在HTML中声明为<code>acme-sales-customer-info</code>。</p>
<p><em>为什么？</em>：方便快速识别directive的内容和起源，例如<code>acme-</code>可能预示着这个directive是服务于Acme company。</p>
<p>注：避免使用<code>ng-</code>为前缀，研究一下其它广泛使用的directive避免命名冲突，例如<a href="http://ionicframework.com/" target="_blank" rel="noopener">Ionic Framework</a>的<code>ion-</code>。</p>
</li>
</ul>
<h3 id="限制元素和属性"><a href="#限制元素和属性" class="headerlink" title="限制元素和属性"></a>限制元素和属性</h3><ul>
<li><p>当创建一个directive需要作为一个独立元素时，restrict值设置为<code>E</code>（自定义元素），也可以设置可选值<code>A</code>（自定义属性）。一般来说，如果它就是为了独立存在，用<code>E</code>是合适的做法。一般原则是允许<code>EA</code>，但是当它是独立的时候这更倾向于作为一个元素来实施，当它是为了增强已存在的DOM元素时则更倾向于作为一个属性来实施。</p>
<p><em>为什么？</em>：这很有意义！</p>
<p><em>为什么？</em>：虽然我们允许directive被当作一个class来使用，但如果这个directive的行为确实像一个元素的话，那么把directive当作元素或者属性是更有意义的。</p>
<p>注：Angular 1.3 +默认使用EA。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- avoid --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"my-calendar-range"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.widgets'</span>)</span><br><span class="line">    .directive(<span class="string">'myCalendarRange'</span>, myCalendarRange);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCalendarRange</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> directive = &#123;</span><br><span class="line">        link: link,</span><br><span class="line">        templateUrl: <span class="string">'/template/is/located/here.html'</span>,</span><br><span class="line">        restrict: <span class="string">'C'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> directive;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">link</span>(<span class="params">scope, element, attrs</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- recommended --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">my-calendar-range</span>&gt;</span><span class="tag">&lt;/<span class="name">my-calendar-range</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">my-calendar-range</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.widgets'</span>)</span><br><span class="line">    .directive(<span class="string">'myCalendarRange'</span>, myCalendarRange);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myCalendarRange</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> directive = &#123;</span><br><span class="line">        link: link,</span><br><span class="line">        templateUrl: <span class="string">'/template/is/located/here.html'</span>,</span><br><span class="line">        restrict: <span class="string">'EA'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> directive;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">link</span>(<span class="params">scope, element, attrs</span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Directives和ControllerAs"><a href="#Directives和ControllerAs" class="headerlink" title="Directives和ControllerAs"></a>Directives和ControllerAs</h3><ul>
<li><p>directive使用<code>controller as</code>语法，和view使用<code>controller as</code>保持一致。</p>
<p><em>为什么？</em>：因为不难且有必要这样做。</p>
<p>注意：下面的directive演示了一些你可以在link和directive控制器中使用scope的方法，用controllerAs。这里把template放在行内是为了在一个地方写出这些代码。</p>
<p>注意：关于依赖注入的内容，请看<a href="#手动依赖注入">手动依赖注入</a>。</p>
<p>注意：directive的控制器是在directive外部的，这种风格避免了由于注入造成的<code>return</code>之后的代码无法访问的情况。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">my-example</span> <span class="attr">max</span>=<span class="string">"77"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .directive(<span class="string">'myExample'</span>, myExample);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myExample</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> directive = &#123;</span><br><span class="line">        restrict: <span class="string">'EA'</span>,</span><br><span class="line">        templateUrl: <span class="string">'app/feature/example.directive.html'</span>,</span><br><span class="line">        scope: &#123;</span><br><span class="line">            max: <span class="string">'='</span></span><br><span class="line">        &#125;,</span><br><span class="line">        link: linkFunc,</span><br><span class="line">        controller : ExampleController,</span><br><span class="line">        controllerAs: <span class="string">'vm'</span>,</span><br><span class="line">        bindToController: <span class="literal">true</span> <span class="comment">// because the scope is isolated</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> directive;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">linkFunc</span>(<span class="params">scope, el, attr, ctrl</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'LINK: scope.min = %s *** should be undefined'</span>, scope.min);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'LINK: scope.max = %s *** should be undefined'</span>, scope.max);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'LINK: scope.vm.min = %s'</span>, scope.vm.min);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'LINK: scope.vm.max = %s'</span>, scope.vm.max);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ExampleController.$inject = [<span class="string">'$scope'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExampleController</span>(<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Injecting $scope just for comparison</span></span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    vm.min = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'CTRL: $scope.vm.min = %s'</span>, $scope.vm.min);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'CTRL: $scope.vm.max = %s'</span>, $scope.vm.max);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'CTRL: vm.min = %s'</span>, vm.min);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'CTRL: vm.max = %s'</span>, vm.max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- example.directive.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>max=&#123;&#123;vm.max&#125;&#125;<span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"&#123;&#123;vm.max&#125;&#125;"</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>min=&#123;&#123;vm.min&#125;&#125;<span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"&#123;&#123;vm.min&#125;&#125;"</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意：当你把controller注入到link的函数或可访问的directive的attributes时，你可以把它命名为控制器的属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Alternative to above example</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">linkFunc</span>(<span class="params">scope, el, attr, vm</span>) </span>&#123; <span class="comment">// 和上面例子的区别在于把vm直接传递进来</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'LINK: scope.min = %s *** should be undefined'</span>, scope.min);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'LINK: scope.max = %s *** should be undefined'</span>, scope.max);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'LINK: vm.min = %s'</span>, vm.min);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'LINK: vm.max = %s'</span>, vm.max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>当directive中使用了<code>controller as</code>语法时，如果你想把父级作用域绑定到directive的controller作用域时，使用<code>bindToController = true</code>。</p>
<p><em>为什么？</em>：这使得把外部作用域绑定到directive controller中变得更加简单。</p>
<p>注意：Angular 1.3.0才介绍了<code>bindToController</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">my-example</span> <span class="attr">max</span>=<span class="string">"77"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .directive(<span class="string">'myExample'</span>, myExample);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myExample</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> directive = &#123;</span><br><span class="line">        restrict: <span class="string">'EA'</span>,</span><br><span class="line">        templateUrl: <span class="string">'app/feature/example.directive.html'</span>,</span><br><span class="line">        scope: &#123;</span><br><span class="line">            max: <span class="string">'='</span></span><br><span class="line">        &#125;,</span><br><span class="line">        controller: ExampleController,</span><br><span class="line">        controllerAs: <span class="string">'vm'</span>,</span><br><span class="line">        bindToController: <span class="literal">true</span></span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> directive;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ExampleController</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.min = <span class="number">3</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'CTRL: vm.min = %s'</span>, vm.min);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'CTRL: vm.max = %s'</span>, vm.max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- example.directive.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>max=&#123;&#123;vm.max&#125;&#125;<span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"vm.max"</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>min=&#123;&#123;vm.min&#125;&#125;<span class="tag">&lt;<span class="name">input</span> <span class="attr">ng-model</span>=<span class="string">"vm.min"</span>/&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="9-解决Controller的Promises"><a href="#9-解决Controller的Promises" class="headerlink" title="9. 解决Controller的Promises"></a>9. 解决Controller的Promises</h2><h3 id="Controller-Activation-Promises"><a href="#Controller-Activation-Promises" class="headerlink" title="Controller Activation Promises"></a>Controller Activation Promises</h3><ul>
<li><p>在<code>activate</code>函数中解决controller的启动逻辑。</p>
<p><em>为什么？</em>：把启动逻辑放在一个controller中固定的位置可以方便定位、有利于保持测试的一致性，并能够避免controller中到处都是激活逻辑。</p>
<p><em>为什么？</em>：<code>activate</code>这个controller使得重用刷新视图的逻辑变得很方便，把所有的逻辑都放到了一起，可以让用户更快地看到视图，可以很轻松地对<code>ng-view</code> 或 <code>ui-view</code>使用动画，用户体验更好。</p>
<p>注意：如果你需要在开始使用controller之前有条件地取消路由，那么就用<a href="#style-y081">route resolve</a>来代替。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span>(<span class="params">dataservice</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.avengers = [];</span><br><span class="line">    vm.title = <span class="string">'Avengers'</span>;</span><br><span class="line"></span><br><span class="line">    dataservice.getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">        vm.avengers = data;</span><br><span class="line">        <span class="keyword">return</span> vm.avengers;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span>(<span class="params">dataservice</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.avengers = [];</span><br><span class="line">    vm.title = <span class="string">'Avengers'</span>;</span><br><span class="line"></span><br><span class="line">    activate();</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">activate</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dataservice.getAvengers().then(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            vm.avengers = data;</span><br><span class="line">            <span class="keyword">return</span> vm.avengers;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Route-Resolve-Promises"><a href="#Route-Resolve-Promises" class="headerlink" title="Route Resolve Promises"></a>Route Resolve Promises</h3><ul>
<li><p>当一个controller在激活之前，需要依赖一个promise的完成时，那么就在controller的逻辑执行之前在<code>$routeProvider</code>中解决这些依赖。如果你需要在controller被激活之前有条件地取消一个路由，那么就用route resolver。</p>
</li>
<li><p>当你决定在过渡到视图之前取消路由时，使用route resolve。</p>
<p><em>为什么？</em>：controller在加载前可能需要一些数据，这些数据可能是从一个通过自定义factory或是<a href="https://docs.angularjs.org/api/ng/service/$http" target="_blank" rel="noopener">$http</a>的promise而来的。<a href="https://docs.angularjs.org/api/ngRoute/provider/$routeProvider" target="_blank" rel="noopener">route resolve</a>允许promise在controller的逻辑执行之前解决，因此它可能对从promise中来的数据做一些处理。</p>
<p><em>为什么？</em>：这段代码将在路由后的controller的激活函数中执行，视图立即加载，promise resolve的时候将会开始进行数据绑定，可以（通过<code>ng-view</code>或<code>ui-view</code>）在视图的过渡之间加个loading状态的动画。</p>
<p>注意：这段代码将在路由之前通过一个promise来执行，拒绝了承诺就会取消路由，接受了就会等待路由跳转到新视图。如果你想更快地进入视图，并且无需验证是否可以进入视图，你可以考虑用<a href="#style-y080">控制器 <code>activate</code> 技术</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Avengers'</span>, Avengers);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span> (<span class="params">movieService</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    <span class="comment">// unresolved</span></span><br><span class="line">    vm.movies;</span><br><span class="line">    <span class="comment">// resolved asynchronously</span></span><br><span class="line">    movieService.getMovies().then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">        vm.movies = response.movies;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* better */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// route-config.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .config(config);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span> (<span class="params">$routeProvider</span>) </span>&#123;</span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">'/avengers'</span>, &#123;</span><br><span class="line">            templateUrl: <span class="string">'avengers.html'</span>,</span><br><span class="line">            controller: <span class="string">'Avengers'</span>,</span><br><span class="line">            controllerAs: <span class="string">'vm'</span>,</span><br><span class="line">            resolve: &#123;</span><br><span class="line">                moviesPrepService: <span class="function"><span class="keyword">function</span>(<span class="params">movieService</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> movieService.getMovies();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// avengers.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Avengers'</span>, Avengers);</span><br><span class="line"></span><br><span class="line">Avengers.$inject = [<span class="string">'moviesPrepService'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span> (<span class="params">moviesPrepService</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.movies = moviesPrepService.movies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：下面这个例子展示了命名函数的路由解决，这种方式对于调试和处理依赖注入更加方便。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* even better */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// route-config.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .config(config);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span>(<span class="params">$routeProvider</span>) </span>&#123;</span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">'/avengers'</span>, &#123;</span><br><span class="line">            templateUrl: <span class="string">'avengers.html'</span>,</span><br><span class="line">            controller: <span class="string">'Avengers'</span>,</span><br><span class="line">            controllerAs: <span class="string">'vm'</span>,</span><br><span class="line">            resolve: &#123;</span><br><span class="line">                moviesPrepService: moviesPrepService</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">moviesPrepService</span>(<span class="params">movieService</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> movieService.getMovies();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// avengers.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Avengers'</span>, Avengers);</span><br><span class="line"></span><br><span class="line">Avengers.$inject = [<span class="string">'moviesPrepService'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span>(<span class="params">moviesPrepService</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">      vm.movies = moviesPrepService.movies;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：示例代码中的<code>movieService</code>不符合安全压缩的做法，可以到<a href="#手动依赖注入">手动依赖注入</a>和<a href="#压缩和注释">压缩和注释</a>部分学习如何安全压缩。</p>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="10-手动依赖注入"><a href="#10-手动依赖注入" class="headerlink" title="10. 手动依赖注入"></a>10. 手动依赖注入</h2><h3 id="压缩的不安全性"><a href="#压缩的不安全性" class="headerlink" title="压缩的不安全性"></a>压缩的不安全性</h3><ul>
<li><p>声明依赖时避免使用缩写语法。</p>
<p><em>为什么？</em>：组件的参数（例如controller、factory等等）将会被转换成各种乱七八糟错误的变量。例如，<code>common</code>和<code>dataservice</code>可能会变成<code>a</code>或者<code>b</code>，但是这些转换后的变量在Angular中是找不到的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid - not minification-safe*/</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Dashboard'</span>, Dashboard);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dashboard</span>(<span class="params">common, dataservice</span>) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这一段代码在压缩时会产生错误的变量，因此在运行时就会报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid - not minification-safe*/</span></span><br><span class="line">angular.module(<span class="string">'app'</span>).controller(<span class="string">'Dashboard'</span>, d);<span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">a, b</span>) </span>&#123; &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="手动添加依赖"><a href="#手动添加依赖" class="headerlink" title="手动添加依赖"></a>手动添加依赖</h3><ul>
<li><p>用<code>$inject</code>手动添加Angular组件所需的依赖。</p>
<p><em>为什么？</em>：这种技术反映了使用<a href="https://github.com/olov/ng-annotate" target="_blank" rel="noopener"><code>ng-annotate</code></a>的技术，这就是我推荐的对依赖关系进行自动化创建安全压缩的方式，如果<code>ng-annotate</code>检测到已经有了注入，那么它就不会再次重复执行。</p>
<p><em>为什么？</em>：可以避免依赖变成其它Angular找不到的变量，例如，<code>common</code>和<code>dataservice</code>可能会变成<code>a</code>或者<code>b</code>。</p>
<p><em>为什么？</em>：避免创建内嵌的依赖，因为一个数组太长不利于阅读，此外，内嵌的方式也会让人感到困惑，比如数组是一系列的字符串，但是最后一个却是组件的function。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Dashboard'</span>,</span><br><span class="line">        [<span class="string">'$location'</span>, <span class="string">'$routeParams'</span>, <span class="string">'common'</span>, <span class="string">'dataservice'</span>,</span><br><span class="line">            <span class="function"><span class="keyword">function</span> <span class="title">Dashboard</span>(<span class="params">$location, $routeParams, common, dataservice</span>) </span>&#123;&#125;</span><br><span class="line">        ]);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Dashboard'</span>,</span><br><span class="line">      [<span class="string">'$location'</span>, <span class="string">'$routeParams'</span>, <span class="string">'common'</span>, <span class="string">'dataservice'</span>, Dashboard]);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dashboard</span>(<span class="params">$location, $routeParams, common, dataservice</span>) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Dashboard'</span>, Dashboard);</span><br><span class="line"></span><br><span class="line">Dashboard.$inject = [<span class="string">'$location'</span>, <span class="string">'$routeParams'</span>, <span class="string">'common'</span>, <span class="string">'dataservice'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dashboard</span>(<span class="params">$location, $routeParams, common, dataservice</span>) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：当你的函数处于return语句后面，那么<code>$inject</code>是无法访问的（这会在directive中发生），你可以通过把Controller移到directive外面来解决这个问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* avoid */</span></span><br><span class="line"><span class="comment">// inside a directive definition</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ddo = &#123;</span><br><span class="line">        controller: DashboardPanelController,</span><br><span class="line">        controllerAs: <span class="string">'vm'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> ddo;</span><br><span class="line"></span><br><span class="line">    DashboardPanelController.$inject = [<span class="string">'logger'</span>]; <span class="comment">// Unreachable</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">DashboardPanelController</span>(<span class="params">logger</span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="comment">// outside a directive definition</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">outer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ddo = &#123;</span><br><span class="line">        controller: DashboardPanelController,</span><br><span class="line">        controllerAs: <span class="string">'vm'</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> ddo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DashboardPanelController.$inject = [<span class="string">'logger'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">DashboardPanelController</span>(<span class="params">logger</span>) </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="手动确定路由解析器依赖"><a href="#手动确定路由解析器依赖" class="headerlink" title="手动确定路由解析器依赖"></a>手动确定路由解析器依赖</h3><ul>
<li><p>用<code>$inject</code>手动给Angular组件添加路由解析器依赖。</p>
<p><em>为什么？</em>：这种技术打破了路由解析的匿名函数的形式，易读。</p>
<p><em>为什么？</em>：<code>$inject</code>语句可以让任何依赖都可以安全压缩。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span> (<span class="params">$routeProvider</span>) </span>&#123;</span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">'/avengers'</span>, &#123;</span><br><span class="line">            templateUrl: <span class="string">'avengers.html'</span>,</span><br><span class="line">            controller: <span class="string">'AvengersController'</span>,</span><br><span class="line">            controllerAs: <span class="string">'vm'</span>,</span><br><span class="line">            resolve: &#123;</span><br><span class="line">                moviesPrepService: moviesPrepService</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">moviesPrepService.$inject =  [<span class="string">'movieService'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">moviesPrepService</span>(<span class="params">movieService</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> movieService.getMovies();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="11-压缩和注释"><a href="#11-压缩和注释" class="headerlink" title="11. 压缩和注释"></a>11. 压缩和注释</h2><h3 id="ng-annotate"><a href="#ng-annotate" class="headerlink" title="ng-annotate"></a>ng-annotate</h3><ul>
<li><p>在<a href="http://gulpjs.com" target="_blank" rel="noopener">Gulp</a>或<a href="http://gruntjs.com" target="_blank" rel="noopener">Grunt</a>中使用<a href="//github.com/olov/ng-annotate">ng-annotate</a>，用<code>/** @ngInject */</code>对需要自动依赖注入的function进行注释。</p>
<p><em>为什么？</em>：可以避免代码中的依赖使用到任何不安全的写法。</p>
<p><em>为什么？</em>：不推荐用<a href="https://github.com/btford/ngmin" target="_blank" rel="noopener"><code>ng-min</code></a>。</p>
<blockquote>
<p>我更喜欢Gulp，因为我觉得它是易写易读易调试的。</p>
</blockquote>
<p>下面的代码没有注入依赖，显然压缩是不安全的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Avengers'</span>, Avengers);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* @ngInject */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span> (<span class="params">storageService, avengerService</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.heroSearch = <span class="string">''</span>;</span><br><span class="line">    vm.storeHero = storeHero;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">storeHero</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> hero = avengerService.find(vm.heroSearch);</span><br><span class="line">      storageService.save(hero.name, hero);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当上面的代码通过ng-annotate运行时，就会产生如下的带有<code>$inject</code>注释的输出结果，这样的话压缩就会安全了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .controller(<span class="string">'Avengers'</span>, Avengers);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* @ngInject */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Avengers</span> (<span class="params">storageService, avengerService</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> vm = <span class="keyword">this</span>;</span><br><span class="line">    vm.heroSearch = <span class="string">''</span>;</span><br><span class="line">    vm.storeHero = storeHero;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">storeHero</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">var</span> hero = avengerService.find(vm.heroSearch);</span><br><span class="line">      storageService.save(hero.name, hero);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Avengers.$inject = [<span class="string">'storageService'</span>, <span class="string">'avengerService'</span>];</span><br></pre></td></tr></table></figure>

<p>注意：如果<code>ng-annotate</code>检测到已经有注入了（例如发现了<code>@ngInject</code>），就不会重复生成<code>$inject</code>代码了。</p>
<p>注意：路由的函数前面也可以用<code>/* @ngInject */</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Using @ngInject annotations</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span>(<span class="params">$routeProvider</span>) </span>&#123;</span><br><span class="line">    $routeProvider</span><br><span class="line">        .when(<span class="string">'/avengers'</span>, &#123;</span><br><span class="line">            templateUrl: <span class="string">'avengers.html'</span>,</span><br><span class="line">            controller: <span class="string">'Avengers'</span>,</span><br><span class="line">            controllerAs: <span class="string">'vm'</span>,</span><br><span class="line">            resolve: &#123; <span class="comment">/* @ngInject */</span></span><br><span class="line">                moviesPrepService: <span class="function"><span class="keyword">function</span>(<span class="params">movieService</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">return</span> movieService.getMovies();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：从Angular 1.3开始，你就可以用<a href="https://docs.angularjs.org/api/ng/directive/ngApp" target="_blank" rel="noopener"><code>ngApp</code></a>指令的 <code>ngStrictDi</code>参数来检测任何可能失去依赖的地方，当以“strict-di”模式创建injector时，会导致应用程序无法调用不使用显示函数注释的函数（这也许无法安全压缩）。记录在控制台的调试信息可以帮助追踪出问题的代码。我只在需要调试的时候才会用到<code>ng-strict-di</code>。<br><code>&lt;body ng-app=&quot;APP&quot; ng-strict-di&gt;</code></p>
</blockquote>
</li>
</ul>
<h3 id="使用Gulp或Grunt结合ng-annotate"><a href="#使用Gulp或Grunt结合ng-annotate" class="headerlink" title="使用Gulp或Grunt结合ng-annotate"></a>使用Gulp或Grunt结合ng-annotate</h3><ul>
<li><p>在自动化任务中使用<a href="https://www.npmjs.org/package/gulp-ng-annotate" target="_blank" rel="noopener">gulp-ng-annotate</a>或<a href="https://www.npmjs.org/package/grunt-ng-annotate" target="_blank" rel="noopener">grunt-ng-annotate</a>，把<code>/* @ngInject */</code>注入到任何有依赖关系函数的前面。</p>
<p><em>为什么？*：ng-annotate会捕获大部分的依赖关系，但是有时候需要借助于`/</em> @ngInject */`语法提示。</p>
<p>下面的代码是gulp任务使用ngAnnotate的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'js'</span>, [<span class="string">'jshint'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> source = pkg.paths.js;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> gulp.src(source)</span><br><span class="line">        .pipe(sourcemaps.init())</span><br><span class="line">        .pipe(concat(<span class="string">'all.min.js'</span>, &#123;<span class="attr">newLine</span>: <span class="string">';'</span>&#125;))</span><br><span class="line">        <span class="comment">// Annotate before uglify so the code get's min'd properly.</span></span><br><span class="line">        .pipe(ngAnnotate(&#123;</span><br><span class="line">            <span class="comment">// true helps add where @ngInject is not used. It infers.</span></span><br><span class="line">            <span class="comment">// Doesn't work with resolve, so we must be explicit there</span></span><br><span class="line">            add: <span class="literal">true</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .pipe(bytediff.start())</span><br><span class="line">        .pipe(uglify(&#123;<span class="attr">mangle</span>: <span class="literal">true</span>&#125;))</span><br><span class="line">        .pipe(bytediff.stop())</span><br><span class="line">        .pipe(sourcemaps.write(<span class="string">'./'</span>))</span><br><span class="line">        .pipe(gulp.dest(pkg.paths.dev));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="12-异常处理"><a href="#12-异常处理" class="headerlink" title="12. 异常处理"></a>12. 异常处理</h2><h3 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h3><ul>
<li><p>使用一个<a href="https://docs.angularjs.org/api/auto/service/$provide#decorator" target="_blank" rel="noopener">decorator</a>，在配置的时候用<a href="https://docs.angularjs.org/api/auto/service/$provide" target="_blank" rel="noopener"><code>$provide</code></a>服务，当发生异常时，在<a href="https://docs.angularjs.org/api/ng/service/$exceptionHandler" target="_blank" rel="noopener"><code>$exceptionHandler</code></a>服务中执行自定义的处理方法。</p>
<p><em>为什么？</em>：在开发时和运行时提供了一种统一的方式来处理未被捕获的Angular异常。</p>
<p>注：另一个选项是用来覆盖service的，这个可以代替decorator，这是一个非常nice的选项，但是如果你想保持默认行为，那么推荐你扩展一个decorator。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'blocks.exception'</span>)</span><br><span class="line">    .config(exceptionConfig);</span><br><span class="line"></span><br><span class="line">exceptionConfig.$inject = [<span class="string">'$provide'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exceptionConfig</span>(<span class="params">$provide</span>) </span>&#123;</span><br><span class="line">    $provide.decorator(<span class="string">'$exceptionHandler'</span>, extendExceptionHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extendExceptionHandler.$inject = [<span class="string">'$delegate'</span>, <span class="string">'toastr'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extendExceptionHandler</span>(<span class="params">$delegate, toastr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">exception, cause</span>) </span>&#123;</span><br><span class="line">        $delegate(exception, cause);</span><br><span class="line">        <span class="keyword">var</span> errorData = &#123;</span><br><span class="line">          exception: exception,</span><br><span class="line">          cause: cause</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Could add the error to a service's collection,</span></span><br><span class="line"><span class="comment">         * add errors to $rootScope, log errors to remote web server,</span></span><br><span class="line"><span class="comment">         * or log locally. Or throw hard. It is entirely up to you.</span></span><br><span class="line"><span class="comment">         * throw exception;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        toastr.error(exception.msg, errorData);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="异常捕获器"><a href="#异常捕获器" class="headerlink" title="异常捕获器"></a>异常捕获器</h3><ul>
<li><p>创建一个暴露了一个接口的factory来捕获异常并以合适方式处理异常。</p>
<p><em>为什么？</em>：提供了一个统一的方法来捕获代码中抛出的异常。</p>
<p>注：异常捕获器对特殊异常的捕获和反应是非常友好的，例如，使用XHR从远程服务获取数据时，你想要捕获所有异常并做出不同的反应。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'blocks.exception'</span>)</span><br><span class="line">    .factory(<span class="string">'exception'</span>, exception);</span><br><span class="line"></span><br><span class="line">exception.$inject = [<span class="string">'logger'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exception</span>(<span class="params">logger</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> service = &#123;</span><br><span class="line">        catcher: catcher</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> service;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">catcher</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">            logger.error(message, reason);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="路由错误"><a href="#路由错误" class="headerlink" title="路由错误"></a>路由错误</h3><ul>
<li><p>用<a href="https://docs.angularjs.org/api/ngRoute/service/$route#$routeChangeError" target="_blank" rel="noopener"><code>$routeChangeError</code></a>来处理并打印出所有的路由错误信息。</p>
<p><em>为什么？</em>：提供一个统一的方式来处理所有的路由错误。</p>
<p><em>为什么？</em>：当一个路由发生错误的时候，可以给展示一个提示信息，提高用户体验。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* recommended */</span></span><br><span class="line"><span class="keyword">var</span> handlingRouteChangeError = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleRoutingErrors</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Route cancellation:</span></span><br><span class="line"><span class="comment">     * On routing error, go to the dashboard.</span></span><br><span class="line"><span class="comment">     * Provide an exit clause if it tries to do it twice.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    $rootScope.$on(<span class="string">'$routeChangeError'</span>,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">event, current, previous, rejection</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (handlingRouteChangeError) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">            handlingRouteChangeError = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">var</span> destination = (current &amp;&amp; (current.title ||</span><br><span class="line">                current.name || current.loadedTemplateUrl)) ||</span><br><span class="line">                <span class="string">'unknown target'</span>;</span><br><span class="line">            <span class="keyword">var</span> msg = <span class="string">'Error routing to '</span> + destination + <span class="string">'. '</span> +</span><br><span class="line">                (rejection.msg || <span class="string">''</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * Optionally log using a custom service or $log.</span></span><br><span class="line"><span class="comment">             * (Don't forget to inject custom service)</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            logger.warning(msg, [current]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * On routing error, go to another route/state.</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            $location.path(<span class="string">'/'</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="13-命名"><a href="#13-命名" class="headerlink" title="13. 命名"></a>13. 命名</h2><h3 id="命名原则"><a href="#命名原则" class="headerlink" title="命名原则"></a>命名原则</h3><ul>
<li><p>遵循以描述组件功能，然后是类型（可选）的方式来给所有的组件提供统一的命名，我推荐的做法是<code>feature.type.js</code>。大多数文件都有2个名字。</p>
<ul>
<li>文件名 (<code>avengers.controller.js</code>)</li>
<li>带有Angular的注册组件名 (<code>AvengersController</code>)</li>
</ul>
<p><em>为什么？</em>：命名约定有助于为一目了然地找到内容提供一个统一的方式，在项目中和团队中保持统一性是非常重要的，保持统一性对于跨公司来说提供了巨大的效率。</p>
<p><em>为什么？</em>：命名约定应该只为代码的检索和沟通提供方便。</p>
</li>
</ul>
<h3 id="功能文件命名"><a href="#功能文件命名" class="headerlink" title="功能文件命名"></a>功能文件命名</h3><ul>
<li><p>遵循以“描述组件功能.类型（可选）”的方式来给所有的组件提供统一的命名，我推荐的做法是<code>feature.type.js</code>。</p>
<p><em>为什么？</em>：为快速识别组件提供了统一的方式。</p>
<p><em>为什么？</em>：为任何自动化的任务提供模式匹配。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * common options</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Controllers</span></span><br><span class="line">avengers.js</span><br><span class="line">avengers.controller.js</span><br><span class="line">avengersController.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// Services/Factories</span></span><br><span class="line">logger.js</span><br><span class="line">logger.service.js</span><br><span class="line">loggerService.js</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// controllers</span></span><br><span class="line">avengers.controller.js</span><br><span class="line">avengers.controller.spec.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// services/factories</span></span><br><span class="line">logger.service.js</span><br><span class="line">logger.service.spec.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// constants</span></span><br><span class="line">constants.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// module definition</span></span><br><span class="line">avengers.module.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// routes</span></span><br><span class="line">avengers.routes.js</span><br><span class="line">avengers.routes.spec.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// configuration</span></span><br><span class="line">avengers.config.js</span><br><span class="line"></span><br><span class="line"><span class="comment">// directives</span></span><br><span class="line">avenger-profile.directive.js</span><br><span class="line">avenger-profile.directive.spec.js</span><br></pre></td></tr></table></figure>

<p>注意：另外一种常见的约定就是不要用<code>controller</code>这个词来给controller文件命名，例如不要用<code>avengers.controller.js</code>，而是用<code>avengers.js</code>。所有其它的约定都坚持使用类型作为后缀，但是controller是组件中最为常用的类型，因此这种做法的好处貌似仅仅是节省了打字，但是仍然很容易识别。我建议你为你的团队选择一种约定，并且要保持统一性。我喜欢的命名方式是<code>avengers.controller.js</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// Controllers</span></span><br><span class="line">avengers.js</span><br><span class="line">avengers.spec.js</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="测试文件命名"><a href="#测试文件命名" class="headerlink" title="测试文件命名"></a>测试文件命名</h3><ul>
<li><p>和组件命名差不多，带上一个<code>spec</code>后缀。</p>
<p><em>为什么？</em>：为快速识别组件提供统一的方式。</p>
<p><em>为什么？</em>：为<a href="http://karma-runner.github.io/" target="_blank" rel="noopener">karma</a>或是其它测试运行器提供模式匹配。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">avengers.controller.spec.js</span><br><span class="line">logger.service.spec.js</span><br><span class="line">avengers.routes.spec.js</span><br><span class="line">avenger-profile.directive.spec.js</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Controller命名"><a href="#Controller命名" class="headerlink" title="Controller命名"></a>Controller命名</h3><ul>
<li><p>为所有controller提供统一的名称，先特征后名字，鉴于controller是构造函数，所以要采用UpperCamelCase（每个单词首字母大写）的方式。</p>
<p><em>为什么？</em>：为快速识别和引用controller提供统一的方式。</p>
<p><em>为什么？</em>：UpperCamelCase是常规的识别一个可以用构造函数来实例化的对象的方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// avengers.controller.js</span></span><br><span class="line">angular</span><br><span class="line">    .module</span><br><span class="line">    .controller(<span class="string">'HeroAvengersController'</span>, HeroAvengersController);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">HeroAvengers</span>(<span class="params"></span>)</span>&#123; &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Controller命名后缀"><a href="#Controller命名后缀" class="headerlink" title="Controller命名后缀"></a>Controller命名后缀</h3><ul>
<li><p>使用<code>Controller</code>。</p>
<p><em>为什么？</em>：<code>Controller</code>使用更广泛、更明确、更具有描述性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// avengers.controller.js</span></span><br><span class="line">angular</span><br><span class="line">    .module</span><br><span class="line">    .controller(<span class="string">'AvengersController'</span>, AvengersController);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AvengersController</span>(<span class="params"></span>)</span>&#123; &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Factory命名"><a href="#Factory命名" class="headerlink" title="Factory命名"></a>Factory命名</h3><ul>
<li><p>一样要统一，对service和factory使用camel-casing（驼峰式，第一个单词首字母小写，后面单词首字母大写）方式。避免使用<code>$</code>前缀。</p>
<p><em>为什么？</em>：可以快速识别和引用factory。</p>
<p><em>为什么？</em>：避免与内部使用<code>$</code>前缀的服务发生冲突。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// logger.service.js</span></span><br><span class="line">angular</span><br><span class="line">    .module</span><br><span class="line">    .factory(<span class="string">'logger'</span>, logger);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params"></span>)</span>&#123; &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Directive组件命名"><a href="#Directive组件命名" class="headerlink" title="Directive组件命名"></a>Directive组件命名</h3><ul>
<li><p>使用camel-case方式，用一个短的前缀来描述directive在哪个区域使用（一些例子中是使用公司前缀或是项目前缀）。</p>
<p><em>为什么？</em>：可以快速识别和引用controller。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// avenger-profile.directive.js</span></span><br><span class="line">angular</span><br><span class="line">    .module</span><br><span class="line">    .directive(<span class="string">'xxAvengerProfile'</span>, xxAvengerProfile);</span><br><span class="line"></span><br><span class="line"><span class="comment">// usage is &lt;xx-avenger-profile&gt; &lt;/xx-avenger-profile&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xxAvengerProfile</span>(<span class="params"></span>)</span>&#123; &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h3><ul>
<li><p>当有很多的模块时，主模块文件命名成<code>app.module.js</code>，其它依赖模块以它们代表的内容来命名。例如，一个管理员模块命名成<code>admin.module.js</code>，它们各自的注册模块名字就是<code>app</code>和<code>admin</code>。</p>
<p><em>为什么？</em>：给多模块的应用提供统一的方式，这也是为了扩展大型应用。</p>
<p><em>为什么？</em>：对使用任务来自动化加载所有模块的定义（先）和其它所有的angular文件（后）提供了一种简单的方式。</p>
</li>
</ul>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><p>把一个模块的配置独立到它自己的文件中，以这个模块为基础命名。<code>app</code>模块的配置文件命名成<code>app.config.js</code>（或是<code>config.js</code>），<code>admin.module.js</code>的配置文件命名成<code>admin.config.js</code>。</p>
<p><em>为什么？</em>：把配置从模块定义、组件和活跃代码中分离出来。</p>
<p><em>为什么？</em>：为设置模块的配置提供了一个可识别的地方。</p>
</li>
</ul>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><ul>
<li>把路由的配置独立到单独的文件。主模块的路由可能是<code>app.route.js</code>，<code>admin</code>模块的路由可能是<code>admin.route.js</code>。即使是在很小的应用中，我也喜欢把路由的配置从其余的配置中分离出来。</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="14-应用程序结构的LIFT准则"><a href="#14-应用程序结构的LIFT准则" class="headerlink" title="14. 应用程序结构的LIFT准则"></a>14. 应用程序结构的LIFT准则</h2><h3 id="LIFT"><a href="#LIFT" class="headerlink" title="LIFT"></a>LIFT</h3><ul>
<li><p>构建一个可以快速定位（<code>L</code>ocate）代码、一目了然地识别（<code>I</code>dentify）代码、拥有一个平直（<code>F</code>lattest）的结构、尽量（<code>T</code>ry）坚持DRY（Don’t Repeat Yourself）的应用程序，其结构应该遵循这4项基本准则。</p>
<p><em>为什么是LIFT?</em>: 提供一个有良好扩展的结构，并且是模块化的，更快的找到代码能够帮助开发者提高效率。另一种检查你的app结构的方法就是问你自己：你能多块地打开涉及到一个功能的所有相关文件并开始工作？</p>
<p>当我发现我的的代码结构很恶心的时候，我就重新看看LIFT准则。</p>
<ol>
<li>轻松定位代码（L）</li>
<li>一眼识别代码（I）</li>
<li>平直的代码结构（层级不要太多）（F）</li>
<li>尽量保持不要写重复代码（T）</li>
</ol>
</li>
</ul>
<h3 id="Locate"><a href="#Locate" class="headerlink" title="Locate"></a>Locate</h3><ul>
<li><p>更直观、更简单、更快捷地定位代码</p>
<p><em>为什么？</em>：我发现这对于一个项目是非常重要的，如果一个团队不能快速找到他们需要工作的文件，这将不能使团队足够高效地工作，那么这个代码结构就得改变。你可能不知道文件名或是相关的文件放在了哪里，那么就把他们放在最直观的地方，放在一起会节省大量的时间。下面是一个参考目录结构。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/bower_components</span><br><span class="line">/client</span><br><span class="line">  /app</span><br><span class="line">    /avengers</span><br><span class="line">    /blocks</span><br><span class="line">      /exception</span><br><span class="line">      /logger</span><br><span class="line">    /core</span><br><span class="line">    /dashboard</span><br><span class="line">    /data</span><br><span class="line">    /layout</span><br><span class="line">    /widgets</span><br><span class="line">  /content</span><br><span class="line">  index.html</span><br><span class="line">.bower.json</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Identify"><a href="#Identify" class="headerlink" title="Identify"></a>Identify</h3><ul>
<li><p>当你看到一个文件时你应该能够立即知道它包含了什么、代表了什么。</p>
<p><em>为什么？</em>：你花费更少的时间来了解代码代表了什么，并且变得更加高效。如果这意味着你需要更长的名字，那么就这么干吧。文件名一定要具有描述性，保持和文件内容互为一体。避免文件中有多个controller，多个service，甚至是混合的。</p>
</li>
</ul>
<h3 id="Flat"><a href="#Flat" class="headerlink" title="Flat"></a>Flat</h3><ul>
<li><p>尽可能长时间地保持一个平直的文件夹结构，如果你的文件夹层级超过7+，那么就开始考虑分离。</p>
<p><em>为什么？</em>：没有谁想在一个7级文件夹中寻找一个文件，你可以考虑一下网页导航栏有那么多层。文件夹结构没有硬性规则，但是当一个文件夹下的文件有7-10个，那么就是时候创建子文件夹了，文件夹的层级一定要把握好。一直使用一个平直的结构，直到确实有必要（帮助其它的LIFT）创建一个新的文件夹。</p>
</li>
</ul>
<h3 id="T-DRY（尽量坚持DRY）"><a href="#T-DRY（尽量坚持DRY）" class="headerlink" title="T-DRY（尽量坚持DRY）"></a>T-DRY（尽量坚持DRY）</h3><ul>
<li><p>坚持DRY，但是不要疯了一样的做却牺牲了可读性。</p>
<p><em>为什么？</em>：保持DRY很重要，但是如果牺牲了其它LIFT，那么它就没那么重要了，这就是为什么说尽量坚持DRY。</p>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="15-应用程序结构"><a href="#15-应用程序结构" class="headerlink" title="15. 应用程序结构"></a>15. 应用程序结构</h2><h3 id="总规范"><a href="#总规范" class="headerlink" title="总规范"></a>总规范</h3><ul>
<li><p>有实施的短期看法和长远的目标，换句话说，从小处入手，但是要记住app的走向。app的所有代码都在一个叫做<code>app</code>的根目录下，所有的内容都遵循一个功能一个文件，每一个controller、service、module、view都是独立的文件。第三方脚本存放在另外的根文件夹中（<code>bower_components</code>、<code>scripts</code>、<code>lib</code>）。</p>
<p>注：了解实例结构的具体信息看<a href="http://www.johnpapa.net/angular-app-structuring-guidelines/" target="_blank" rel="noopener">Angular应用结构</a>。</p>
</li>
</ul>
<h3 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h3><ul>
<li><p>把定义应用程序总体布局的组件放到<code>layout</code>文件夹中，如导航、内容区等等。</p>
<p><em>为什么？</em>：复用。</p>
</li>
</ul>
<h3 id="按功能划分文件夹结构"><a href="#按功能划分文件夹结构" class="headerlink" title="按功能划分文件夹结构"></a>按功能划分文件夹结构</h3><ul>
<li><p>按照它们代表的功能来给创建的文件夹命名，当文件夹包含的文件超过7个（根据需要自行调整数量限制），就考虑新建文件夹。</p>
<p><em>为什么？</em>：开发者可以快速定位代码、快速识别文件代表的意思，结构尽可能平直，没有重复，没有多余名字。</p>
<p><em>为什么？</em>：LIFT规范都包括在内。</p>
<p><em>为什么？</em>：通过组织内容和让它们保持和LIFT指导准则一致，帮助降低应用程序变得混乱的可能性。</p>
<p><em>为什么？</em>：超过10个文件时，在一个一致性的文件夹中很容易定位，但是在一个平直的文件夹结构中确实很难定位。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * recommended</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">app/</span><br><span class="line">    app.module.js</span><br><span class="line">    app.config.js</span><br><span class="line">    directives/</span><br><span class="line">        calendar.directive.js</span><br><span class="line">        calendar.directive.html</span><br><span class="line">        user-profile.directive.js</span><br><span class="line">        user-profile.directive.html</span><br><span class="line">    services/</span><br><span class="line">        dataservice.js</span><br><span class="line">        localstorage.js</span><br><span class="line">        logger.js</span><br><span class="line">        spinner.js</span><br><span class="line">    layout/</span><br><span class="line">        shell.html</span><br><span class="line">        shell.controller.js</span><br><span class="line">        topnav.html</span><br><span class="line">        topnav.controller.js</span><br><span class="line">    people/</span><br><span class="line">        attendees.html</span><br><span class="line">        attendees.controller.js</span><br><span class="line">        people.routes.js</span><br><span class="line">        speakers.html</span><br><span class="line">        speakers.controller.js</span><br><span class="line">        speaker-detail.html</span><br><span class="line">        speaker-detail.controller.js</span><br><span class="line">    sessions/</span><br><span class="line">        sessions.html</span><br><span class="line">        sessions.controller.js</span><br><span class="line">        sessions.routes.js</span><br><span class="line">        session-detail.html</span><br><span class="line">        session-detail.controller.js</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/modularity-2.png" alt="实例App结构"></p>
<p>注意：不要使用按类型划分文件夹结构，因为如果这样的话，当做一个功能时，需要在多个文件夹中来回切换。当应用程序有5个、10个，甚至是25个以上的view、controller（或其他feature）时，这种方式将迅速变得不实用，这就使得它定位文件比按功能分文件夹的方式要困难的多。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * avoid</span></span><br><span class="line"><span class="comment"> * Alternative folders-by-type.</span></span><br><span class="line"><span class="comment"> * I recommend "folders-by-feature", instead.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">app/</span><br><span class="line">    app.module.js</span><br><span class="line">    app.config.js</span><br><span class="line">    app.routes.js</span><br><span class="line">    directives.js</span><br><span class="line">    controllers/</span><br><span class="line">        attendees.js</span><br><span class="line">        session-detail.js</span><br><span class="line">        sessions.js</span><br><span class="line">        shell.js</span><br><span class="line">        speakers.js</span><br><span class="line">        speaker-detail.js</span><br><span class="line">        topnav.js</span><br><span class="line">    directives/</span><br><span class="line">        calendar.directive.js</span><br><span class="line">        calendar.directive.html</span><br><span class="line">        user-profile.directive.js</span><br><span class="line">        user-profile.directive.html</span><br><span class="line">    services/</span><br><span class="line">        dataservice.js</span><br><span class="line">        localstorage.js</span><br><span class="line">        logger.js</span><br><span class="line">        spinner.js</span><br><span class="line">    views/</span><br><span class="line">        attendees.html</span><br><span class="line">        session-detail.html</span><br><span class="line">        sessions.html</span><br><span class="line">        shell.html</span><br><span class="line">        speakers.html</span><br><span class="line">        speaker-detail.html</span><br><span class="line">        topnav.html</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="16-模块化"><a href="#16-模块化" class="headerlink" title="16. 模块化"></a>16. 模块化</h2><h3 id="许多小的、独立的模块"><a href="#许多小的、独立的模块" class="headerlink" title="许多小的、独立的模块"></a>许多小的、独立的模块</h3><ul>
<li><p>创建只封装一个职责的小模块。</p>
<p><em>为什么？</em>：模块化的应用程序很容易添加新的功能。</p>
</li>
</ul>
<h3 id="创建一个App-Module"><a href="#创建一个App-Module" class="headerlink" title="创建一个App Module"></a>创建一个App Module</h3><ul>
<li><p>创建一个应用程序的根模块，它的职责是把应用程序中所有的模块和功能都放到一起。</p>
<p><em>为什么？</em>：Angular鼓励模块化和分离模式。创建根模块的作用是把其它模块都绑定到一起，这为增加或是删除一个模块提供了非常简单的方法。</p>
<p><em>为什么？</em>：应用程序模块变成了一个描述哪些模块有助于定义应用程序的清单。</p>
</li>
</ul>
<h3 id="保持App-Module的精简"><a href="#保持App-Module的精简" class="headerlink" title="保持App Module的精简"></a>保持App Module的精简</h3><ul>
<li><p>app module中只放聚合其它模块的逻辑，具体功能在它们自己的模块中实现。</p>
<p><em>为什么？</em>：添加额外的代码（获取数据、展现视图、其它和聚合模块无关的代码）到app module中使app module变得很糟糕，也使得模块难以重用和关闭。</p>
</li>
</ul>
<h3 id="功能区域就是模块"><a href="#功能区域就是模块" class="headerlink" title="功能区域就是模块"></a>功能区域就是模块</h3><ul>
<li><p>创建代表功能区的模块，例如布局、可重用、共享服务、仪表盘和app的特殊功能（例如客户、管理、销售）。</p>
<p><em>为什么？</em>：自包含的模块可以无缝地被添加到应用程序中。</p>
<p><em>为什么？</em>：项目进行功能迭代时，可以专注于功能，在开发完成启用它们即可。</p>
<p><em>为什么？</em>：把功能拆分成不同模块方便测试。</p>
</li>
</ul>
<h3 id="可重用的块就是模块"><a href="#可重用的块就是模块" class="headerlink" title="可重用的块就是模块"></a>可重用的块就是模块</h3><ul>
<li><p>为通用service创建代表可重用的应用程序块的模块，例如异常处理、日志记录、诊断、安全性和本地数据储藏等模块。</p>
<p><em>为什么？</em>：这些类型的功能在很多应用程序中都需要用到，所以把它们分离到自己的模块中，它们可以变成通用的应用程序，也能被跨应用地进行重用。</p>
</li>
</ul>
<h3 id="模块依赖"><a href="#模块依赖" class="headerlink" title="模块依赖"></a>模块依赖</h3><ul>
<li><p>应用程序根模块依赖于应用程序特定的功能模块、共享的和可复用的模块。</p>
<p><img src="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/modularity-1.png" alt="模块化和依赖"></p>
<p><em>为什么？</em>：主程序模块包含一个能快速识别应用程序功能的清单。</p>
<p><em>为什么？</em>：每个功能区都包含一个它依赖了哪些模块的列表，因此其它应用可以把它当作一个依赖引入进来。</p>
<p><em>为什么？</em>：程序内部的功能，如共享数据的服务变得容易定位，并且从<code>app.core</code>中共享。</p>
<p>注意：这是保持一致性的一种策略，这里有很多不错的选择，选择一种统一的，遵循Angular依赖规则，这将易于维护和扩展。</p>
<blockquote>
<p>我的不同项目间的结构略有不同，但是它们都遵循了这些结构和模块化的准则,具体的实施方案会根据功能和团队发生变化。也就是说，不要在一棵树上吊死，但是心中一定要记得保持一致性、可维护性和效率。</p>
</blockquote>
<blockquote>
<p>小项目中，你可以直接把所有依赖都放到app module中，这对于小项目来说比较容易维护，但是想在此项目外重用模块就比较难了。</p>
</blockquote>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="17-启动逻辑"><a href="#17-启动逻辑" class="headerlink" title="17. 启动逻辑"></a>17. 启动逻辑</h2><h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><ul>
<li><p>必须在angular应用启动前进行配置才能把代码注入到<a href="https://docs.angularjs.org/guide/module#module-loading-dependencies" target="_blank" rel="noopener">模块配置</a>，理想的一些case应该包括providers和constants。</p>
<p><em>为什么？</em>：这使得在更少的地方进行配置变得容易。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .config(configure);</span><br><span class="line"></span><br><span class="line">configure.$inject =</span><br><span class="line">    [<span class="string">'routerHelperProvider'</span>, <span class="string">'exceptionHandlerProvider'</span>, <span class="string">'toastr'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">configure</span> (<span class="params">routerHelperProvider, exceptionHandlerProvider, toastr</span>) </span>&#123;</span><br><span class="line">    exceptionHandlerProvider.configure(config.appErrorPrefix);</span><br><span class="line">    configureStateHelper();</span><br><span class="line"></span><br><span class="line">    toastr.options.timeOut = <span class="number">4000</span>;</span><br><span class="line">    toastr.options.positionClass = <span class="string">'toast-bottom-right'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////////////////</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">configureStateHelper</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        routerHelperProvider.configure(&#123;</span><br><span class="line">            docTitle: <span class="string">'NG-Modular: '</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="运行代码块"><a href="#运行代码块" class="headerlink" title="运行代码块"></a>运行代码块</h3><ul>
<li><p>任何在应用程序启动时需要运行的代码都应该在factory中声明，通过一个function暴露出来，然后注入到<a href="https://docs.angularjs.org/guide/module#module-loading-dependencies" target="_blank" rel="noopener">运行代码块</a>中。</p>
<p><em>为什么？</em>：直接在运行代码块处写代码将会使得测试变得很困难，相反，如果放到facotry则会使的抽象和模拟变得很简单。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app'</span>)</span><br><span class="line">    .run(runBlock);</span><br><span class="line"></span><br><span class="line">runBlock.$inject = [<span class="string">'authenticator'</span>, <span class="string">'translator'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runBlock</span>(<span class="params">authenticator, translator</span>) </span>&#123;</span><br><span class="line">    authenticator.initialize();</span><br><span class="line">    translator.initialize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="18-Angular-包装服务"><a href="#18-Angular-包装服务" class="headerlink" title="18. Angular $包装服务"></a>18. Angular $包装服务</h2><h3 id="document和-window"><a href="#document和-window" class="headerlink" title="$document和$window"></a>$document和$window</h3><ul>
<li><p>用<a href="https://docs.angularjs.org/api/ng/service/$document" target="_blank" rel="noopener"><code>$document</code></a>和<a href="https://docs.angularjs.org/api/ng/service/$window" target="_blank" rel="noopener"><code>$window</code></a>代替<code>document</code>和<code>window</code>。</p>
<p><em>为什么？</em>：使用内部包装服务将更容易测试，也避免了你自己去模拟document和window。</p>
</li>
</ul>
<h3 id="timeout和-interval"><a href="#timeout和-interval" class="headerlink" title="$timeout和$interval"></a>$timeout和$interval</h3><ul>
<li><p>用<a href="https://docs.angularjs.org/api/ng/service/$timeout" target="_blank" rel="noopener"><code>$timeout</code></a>和<a href="https://docs.angularjs.org/api/ng/service/$interval" target="_blank" rel="noopener"><code>$interval</code></a>代替<code>setTimeout</code>和<code>setInterval</code> 。</p>
<p><em>为什么？</em>：易于测试，处理Angular消化周期从而保证数据的同步绑定。</p>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="19-测试"><a href="#19-测试" class="headerlink" title="19. 测试"></a>19. 测试</h2><p>单元测试有助于保持代码的清晰，因此我加入一些关于单元测试的基础和获取更多信息的链接。</p>
<h3 id="用故事来编写测试"><a href="#用故事来编写测试" class="headerlink" title="用故事来编写测试"></a>用故事来编写测试</h3><ul>
<li><p>给每一个故事都写一组测试，先创建一个空的测试，然后用你给这个故事写的代码来填充它。</p>
<p><em>为什么？</em>：编写测试有助于明确规定你的故事要做什么、不做什么以及你如何判断是否成功。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'should have Avengers controller'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//TODO</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">it(<span class="string">'should find 1 Avenger when filtered by name'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//TODO</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">it(<span class="string">'should have 10 Avengers'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//TODO (mock data?)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">it(<span class="string">'should return Avengers via XHR'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//TODO ($httpBackend?)</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// and so on</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="测试库"><a href="#测试库" class="headerlink" title="测试库"></a>测试库</h3><ul>
<li><p>用<a href="http://jasmine.github.io/" target="_blank" rel="noopener">Jasmine</a>或者<a href="http://mochajs.org" target="_blank" rel="noopener">Mocha</a>进行单元测试。</p>
<p><em>为什么？</em>：Angular社区中Jasmine和Mocha都用的很广，两者都很稳定，可维护性好，提供强大的测试功能。</p>
<p>注意：使用Mocha时你可以考虑选择一个类似<a href="http://chaijs.com" target="_blank" rel="noopener">Chai</a>的提示库。</p>
</li>
</ul>
<h3 id="测试运行器"><a href="#测试运行器" class="headerlink" title="测试运行器"></a>测试运行器</h3><ul>
<li><p><a href="http://karma-runner.github.io" target="_blank" rel="noopener">Karma</a>。</p>
<p><em>为什么？</em>：Karma容易配置，代码发生修改时自动运行。</p>
<p><em>为什么？</em>：可以通过自身或是Grunt、Gulp方便地钩入持续集成的进程。</p>
<p><em>为什么？</em>：一些IDE已经开始集成Karma了，如<a href="http://www.jetbrains.com/webstorm/" target="_blank" rel="noopener">WebStorm</a>和<a href="http://visualstudiogallery.msdn.microsoft.com/02f47876-0e7a-4f6c-93f8-1af5d5189225" target="_blank" rel="noopener">Visual Studio</a>。</p>
<p><em>为什么？</em>：Karma可以很好的和自动化任务工具如<a href="http://www.gruntjs.com" target="_blank" rel="noopener">Grunt</a>（带有<a href="https://github.com/karma-runner/grunt-karma" target="_blank" rel="noopener">grunt-karma</a>）和<a href="http://www.gulpjs.com" target="_blank" rel="noopener">Gulp</a>（带有<a href="https://github.com/lazd/gulp-karma" target="_blank" rel="noopener">gulp-karma</a>）合作。</p>
</li>
</ul>
<h3 id="Stubbing和Spying"><a href="#Stubbing和Spying" class="headerlink" title="Stubbing和Spying"></a>Stubbing和Spying</h3><ul>
<li><p>用<a href="http://sinonjs.org/" target="_blank" rel="noopener">Sinon</a>。</p>
<p><em>为什么？</em>：Sinon可以和Jasmine和Mocha合作良好，并且可以扩展它们提供的stubbing和spying。</p>
<p><em>为什么？</em>：如果你想试试Jasmine和Mocha，用Sinon在它们中间来回切换是很方便的。我更喜欢Mocha。</p>
<p><em>为什么？</em>：测试失败Sinon有一个具有描述性的信息。</p>
</li>
</ul>
<h3 id="Headless-Browser"><a href="#Headless-Browser" class="headerlink" title="Headless Browser"></a>Headless Browser</h3><ul>
<li><p>在服务器上使用<a href="http://phantomjs.org/" target="_blank" rel="noopener">PhantomJS</a>来运行你的测试。</p>
<p><em>为什么？</em>：PhantomJS是一个headless browser，无需一个“可视”的浏览器来帮助你运行测试。因此你的服务器上不需要安装Chrome、Safari、IE或是其它浏览器。</p>
<p>注意：你仍然需要在你的环境下测试所有浏览器，来满足用户的需求。</p>
</li>
</ul>
<h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>  -在你的测试上运行JSHint。</p>
<pre><code>*为什么？*：测试也是代码，JSHint能够帮你识别代码中可能导致测试无法正常工作的的质量问题。</code></pre><h3 id="对测试降低全局JSHint规则"><a href="#对测试降低全局JSHint规则" class="headerlink" title="对测试降低全局JSHint规则"></a>对测试降低全局JSHint规则</h3><ul>
<li><p>对你的测试代码放宽规则，这样可以允许使用<code>describe</code>和<code>expect</code>等类似通用的全局方法。对表达式放宽规则，就行Mocha一样。</p>
<p><em>为什么？</em>：测试也是代码，因此要和对待其它生产代码一样重视测试代码的质量。然而，测试框架中允许使用全局变量，例如，在你的测试单例中允许使用this。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* jshint -W117, -W030 */</span></span><br></pre></td></tr></table></figure>

<p>或者你也可以把下面的这几行加入到你的JSHint Options文件中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"jasmine"</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">"mocha"</span>: <span class="literal">true</span>,</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/johnpapa/angular-styleguide/master/a1/assets/testing-tools.png" alt="测试工具"></p>
</li>
</ul>
<h3 id="组织测试"><a href="#组织测试" class="headerlink" title="组织测试"></a>组织测试</h3><ul>
<li><p>将单元测试文件(specs)同被测试客户端代码并列放在同一个文件夹下，将多个组件共用的测试文件以及服务器集成测试的文件放到一个单独的<code>tests</code>文件夹下。</p>
<p><em>为什么？</em>：单元测试和源代码中的每一个组件和文件都有直接的相关性。</p>
<p><em>为什么？</em>：这样它就会一直在你的视野中，很容易让它们保持在最新状态。编码的时候无论你做TDD还是在开发过程中测试，或者开发完成后测试，这些单测都不会脱离你的视线和脑海，这样就更容易维护，也有助于保持代码的覆盖率。</p>
<p><em>为什么？</em>：更新源代码的时候可以更简单地在同一时间更新测试代码。</p>
<p><em>为什么？</em>：方便源码阅读者了解组件如何使用，也便于发现其中的局限性。</p>
<p><em>为什么？</em>：方便找。</p>
<p><em>为什么？</em>：方便使用grunt或者gulp。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/src/client/app/customers/customer-detail.controller.js</span><br><span class="line">                         /customer-detail.controller.spec.js</span><br><span class="line">                         /customers.controller.js</span><br><span class="line">                         /customers.controller.spec.js</span><br><span class="line">                         /customers.module.js</span><br><span class="line">                         /customers.route.js</span><br><span class="line">                         /customers.route.spec.js</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="20-动画"><a href="#20-动画" class="headerlink" title="20. 动画"></a>20. 动画</h2><h3 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h3><ul>
<li><p>在页面过渡时使用<a href="https://docs.angularjs.org/guide/animations" target="_blank" rel="noopener">Angular动画</a>，包括<a href="https://docs.angularjs.org/api/ngAnimate" target="_blank" rel="noopener">ngAnimate模块</a>。三个关键点是细微、平滑、无缝。</p>
<p><em>为什么？</em>：使用得当的话能够提高用户体验。</p>
<p><em>为什么？</em>：当视图过渡时，微小的动画可以提高感知性。</p>
</li>
</ul>
<h3 id="Sub-Second"><a href="#Sub-Second" class="headerlink" title="Sub Second"></a>Sub Second</h3><ul>
<li><p>使用短持续性的动画，我一般使用300ms，然后调整到合适的时间。</p>
<p><em>为什么？</em>：长时间的动画容易造成用户认为程序性能太差的影响。</p>
</li>
</ul>
<h3 id="animate-css"><a href="#animate-css" class="headerlink" title="animate.css"></a>animate.css</h3><ul>
<li><p>传统动画使用<a href="http://daneden.github.io/animate.css/" target="_blank" rel="noopener">animate.css</a>。</p>
<p><em>为什么？</em>：css提供的动画是快速的、流畅的、易于添加到应用程序中的。</p>
<p><em>为什么？</em>：为动画提供一致性。</p>
<p><em>为什么？</em>：animate.css被广泛使用和测试。</p>
<p>注意：参阅<a href="http://www.yearofmoo.com/2013/08/remastered-animation-in-angularjs-1-2.html" target="_blank" rel="noopener">Matias Niemelä的关于Angular动画的文章</a></p>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="21-注释"><a href="#21-注释" class="headerlink" title="21. 注释"></a>21. 注释</h2><h3 id="jsDoc"><a href="#jsDoc" class="headerlink" title="jsDoc"></a>jsDoc</h3><ul>
<li><p>如果你准备做一个文档，那么就使用<a href="http://usejsdoc.org/" target="_blank" rel="noopener"><code>jsDoc</code></a>的语法来记录函数名、描述、参数和返回值。使用<code>@namespace</code>和<code>@memberOf</code>来匹配应用程序结构。</p>
<p><em>为什么？</em>：你可以从代码中生成（重新生成）文档，而不必从头开始编写文档。</p>
<p><em>为什么？</em>：使用业内通用工具保持了统一性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Logger Factory</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@namespace <span class="variable">Factories</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  angular</span><br><span class="line">      .module(<span class="string">'app'</span>)</span><br><span class="line">      .factory(<span class="string">'logger'</span>, logger);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@namespace <span class="variable">Logger</span></span></span></span><br><span class="line"><span class="comment">   * <span class="doctag">@desc </span>Application wide logger</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@memberOf <span class="variable">Factories</span></span></span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">logger</span> (<span class="params">$log</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> service = &#123;</span><br><span class="line">          logError: logError</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> service;</span><br><span class="line"></span><br><span class="line">      <span class="comment">////////////</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@name <span class="variable">logError</span></span></span></span><br><span class="line"><span class="comment">       * <span class="doctag">@desc </span>Logs errors</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>msg Message to log</span></span><br><span class="line"><span class="comment">       * <span class="doctag">@returns <span class="type">&#123;String&#125;</span></span></span></span><br><span class="line"><span class="comment">       * <span class="doctag">@memberOf </span>Factories.Logger</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">logError</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> loggedMsg = <span class="string">'Error: '</span> + msg;</span><br><span class="line">          $log.error(loggedMsg);</span><br><span class="line">          <span class="keyword">return</span> loggedMsg;</span><br><span class="line">      &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="22-JS-Hint"><a href="#22-JS-Hint" class="headerlink" title="22. JS Hint"></a>22. JS Hint</h2><h3 id="使用一个Options文件"><a href="#使用一个Options文件" class="headerlink" title="使用一个Options文件"></a>使用一个Options文件</h3><ul>
<li><p>用JS Hint来分析你的JavaScript代码，确保你自定义了JS Hint选项文件并且包含在源控制里。详细信息：<a href="http://www.jshint.com/docs/" target="_blank" rel="noopener">JS Hint文档</a>。</p>
<p><em>为什么？</em>：提交代码到原版本之前先发出警告。</p>
<p><em>为什么？</em>：统一性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"bitwise"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"camelcase"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"curly"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"eqeqeq"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"es3"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"forin"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"freeze"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"immed"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"indent"</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">"latedef"</span>: <span class="string">"nofunc"</span>,</span><br><span class="line">    <span class="string">"newcap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"noarg"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"noempty"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"nonbsp"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"nonew"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"plusplus"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"quotmark"</span>: <span class="string">"single"</span>,</span><br><span class="line">    <span class="string">"undef"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"unused"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"strict"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"maxparams"</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="string">"maxdepth"</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">"maxstatements"</span>: <span class="number">40</span>,</span><br><span class="line">    <span class="string">"maxcomplexity"</span>: <span class="number">8</span>,</span><br><span class="line">    <span class="string">"maxlen"</span>: <span class="number">120</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"asi"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"boss"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"debug"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"eqnull"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"esnext"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"evil"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"expr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"funcscope"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"globalstrict"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"iterator"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"lastsemic"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"laxbreak"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"laxcomma"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"loopfunc"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"maxerr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"moz"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"multistr"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"notypeof"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"proto"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"scripturl"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"shadow"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"sub"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"supernew"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"validthis"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="string">"noyield"</span>: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"node"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"globals"</span>: &#123;</span><br><span class="line">        <span class="string">"angular"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"$"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="23-JSCS"><a href="#23-JSCS" class="headerlink" title="23. JSCS"></a>23. JSCS</h2><h3 id="用一个Options文件"><a href="#用一个Options文件" class="headerlink" title="用一个Options文件"></a>用一个Options文件</h3><ul>
<li><p>使用JSCS检查代码规范，确保你的代码控制中有定制的JSCS options文件，在这里<a href="http://www.jscs.info" target="_blank" rel="noopener">JSCS docs</a>查看更多信息。</p>
<p><em>为什么？</em>：提交代码前第一时间提供一个预警。</p>
<p><em>为什么？</em>：保持团队的一致性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"excludeFiles"</span>: [<span class="string">"node_modules/**"</span>, <span class="string">"bower_components/**"</span>],</span><br><span class="line"></span><br><span class="line">    <span class="string">"requireCurlyBraces"</span>: [</span><br><span class="line">        <span class="string">"if"</span>,</span><br><span class="line">        <span class="string">"else"</span>,</span><br><span class="line">        <span class="string">"for"</span>,</span><br><span class="line">        <span class="string">"while"</span>,</span><br><span class="line">        <span class="string">"do"</span>,</span><br><span class="line">        <span class="string">"try"</span>,</span><br><span class="line">        <span class="string">"catch"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"requireOperatorBeforeLineBreak"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"requireCamelCaseOrUpperCaseIdentifiers"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"maximumLineLength"</span>: &#123;</span><br><span class="line">      <span class="string">"value"</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="string">"allowComments"</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="string">"allowRegex"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"validateIndentation"</span>: <span class="number">4</span>,</span><br><span class="line">    <span class="string">"validateQuoteMarks"</span>: <span class="string">"'"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"disallowMultipleLineStrings"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"disallowMixedSpacesAndTabs"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"disallowTrailingWhitespace"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"disallowSpaceAfterPrefixUnaryOperators"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"disallowMultipleVarDecl"</span>: <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"requireSpaceAfterKeywords"</span>: [</span><br><span class="line">      <span class="string">"if"</span>,</span><br><span class="line">      <span class="string">"else"</span>,</span><br><span class="line">      <span class="string">"for"</span>,</span><br><span class="line">      <span class="string">"while"</span>,</span><br><span class="line">      <span class="string">"do"</span>,</span><br><span class="line">      <span class="string">"switch"</span>,</span><br><span class="line">      <span class="string">"return"</span>,</span><br><span class="line">      <span class="string">"try"</span>,</span><br><span class="line">      <span class="string">"catch"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"requireSpaceBeforeBinaryOperators"</span>: [</span><br><span class="line">        <span class="string">"="</span>, <span class="string">"+="</span>, <span class="string">"-="</span>, <span class="string">"*="</span>, <span class="string">"/="</span>, <span class="string">"%="</span>, <span class="string">"&lt;&lt;="</span>, <span class="string">"&gt;&gt;="</span>, <span class="string">"&gt;&gt;&gt;="</span>,</span><br><span class="line">        <span class="string">"&amp;="</span>, <span class="string">"|="</span>, <span class="string">"^="</span>, <span class="string">"+="</span>,</span><br><span class="line"></span><br><span class="line">        <span class="string">"+"</span>, <span class="string">"-"</span>, <span class="string">"*"</span>, <span class="string">"/"</span>, <span class="string">"%"</span>, <span class="string">"&lt;&lt;"</span>, <span class="string">"&gt;&gt;"</span>, <span class="string">"&gt;&gt;&gt;"</span>, <span class="string">"&amp;"</span>,</span><br><span class="line">        <span class="string">"|"</span>, <span class="string">"^"</span>, <span class="string">"&amp;&amp;"</span>, <span class="string">"||"</span>, <span class="string">"==="</span>, <span class="string">"=="</span>, <span class="string">"&gt;="</span>,</span><br><span class="line">        <span class="string">"&lt;="</span>, <span class="string">"&lt;"</span>, <span class="string">"&gt;"</span>, <span class="string">"!="</span>, <span class="string">"!=="</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"requireSpaceAfterBinaryOperators"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"requireSpacesInConditionalExpression"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"requireSpaceBeforeBlockStatements"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"requireLineFeedAtFileEnd"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"disallowSpacesInsideObjectBrackets"</span>: <span class="string">"all"</span>,</span><br><span class="line">    <span class="string">"disallowSpacesInsideArrayBrackets"</span>: <span class="string">"all"</span>,</span><br><span class="line">    <span class="string">"disallowSpacesInsideParentheses"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"validateJSDoc"</span>: &#123;</span><br><span class="line">        <span class="string">"checkParamNames"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"requireParamTypes"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">"disallowMultipleLineBreaks"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"disallowCommaBeforeLineBreak"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"disallowDanglingUnderscores"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"disallowEmptyBlocks"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"disallowMultipleLineStrings"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"disallowTrailingComma"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"requireCommaBeforeLineBreak"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"requireDotNotation"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"requireMultipleVarDecl"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"requireParenthesesAroundIIFE"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="24-常量"><a href="#24-常量" class="headerlink" title="24. 常量"></a>24. 常量</h2><p>###供应全局变量</p>
<ul>
<li><p>为供应库中的全局变量创建一个Angular常量。</p>
<p><em>为什么？</em>：提供一种注入到供应库的方法，否则就是全局变量。通过让你更容易地了解你的组件之间的依赖关系来提高代码的可测试性。这还允许你模拟这些依赖关系，这是很有意义的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// constants.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* global toastr:false, moment:false */</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    'use strict'</span>;</span><br><span class="line"></span><br><span class="line">    angular</span><br><span class="line">        .module(<span class="string">'app.core'</span>)</span><br><span class="line">        .constant(<span class="string">'toastr'</span>, toastr)</span><br><span class="line">        .constant(<span class="string">'moment'</span>, moment);</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
</li>
<li><p>对于一些不需要变动，也不需要从其它service中获取的值，使用常量定义，当一些常量只是在一个模块中使用但是有可能会在其它应用中使用的话，把它们写到一个以当前的模块命名的文件中。把常量集合到一起是非常有必要的，你可以把它们写到<code>constants.js</code>的文件中。</p>
<p><em>为什么？</em>：一个可能变化的值，即使变动的很少，也会从service中重新被检索，因此你不需要修改源代码。例如，一个数据服务的url可以被放到一个常量中，但是更好的的做法是把它放到一个web service中。</p>
<p><em>为什么？</em>：常量可以被注入到任何angular组件中，包括providers。</p>
<p><em>为什么？</em>：当一个应用程序被分割成很多可以在其它应用程序中复用的小模块时，每个独立的模块都应该可以操作它自己包含的相关常量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Constants used by the entire app</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.core'</span>)</span><br><span class="line">    .constant(<span class="string">'moment'</span>, moment);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Constants used only by the sales module</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.sales'</span>)</span><br><span class="line">    .constant(<span class="string">'events'</span>, &#123;</span><br><span class="line">        ORDER_CREATED: <span class="string">'event_order_created'</span>,</span><br><span class="line">        INVENTORY_DEPLETED: <span class="string">'event_inventory_depleted'</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="25-文件模板和片段"><a href="#25-文件模板和片段" class="headerlink" title="25. 文件模板和片段"></a>25. 文件模板和片段</h2><p>为了遵循一致的规范和模式，使用文件模板和片段，这里有针对一些web开发的编辑器和IDE的模板和（或）片段。</p>
<h3 id="Sublime-Text"><a href="#Sublime-Text" class="headerlink" title="Sublime Text"></a>Sublime Text</h3><ul>
<li><p>Angular片段遵循这些规范。</p>
<ul>
<li>下载<a href="assets/sublime-angular-snippets?raw=true">Sublime Angular snippets</a></li>
<li>把它放到Packages文件夹中</li>
<li>重启Sublime</li>
<li>在JavaScript文件中输入下面的命令然后按下<code>TAB</code>键即可：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ngcontroller <span class="comment">// creates an Angular controller</span></span><br><span class="line">ngdirective  <span class="comment">// creates an Angular directive</span></span><br><span class="line">ngfactory    <span class="comment">// creates an Angular factory</span></span><br><span class="line">ngmodule     <span class="comment">// creates an Angular module</span></span><br><span class="line">ngservice    <span class="comment">// creates an Angular service</span></span><br><span class="line">ngfilter     <span class="comment">// creates an Angular filter</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Visual-Studio"><a href="#Visual-Studio" class="headerlink" title="Visual Studio"></a>Visual Studio</h3><ul>
<li><p>Angular文件遵循<a href="http://www.sidewaffle.com" target="_blank" rel="noopener">SideWaffle</a>所介绍的规范。</p>
<ul>
<li>下载Visual Studio扩展文件<a href="http://www.sidewaffle.com" target="_blank" rel="noopener">SideWaffle</a></li>
<li>运行下载的vsix文件</li>
<li>重启Visual Studio</li>
</ul>
</li>
</ul>
<h3 id="WebStorm"><a href="#WebStorm" class="headerlink" title="WebStorm"></a>WebStorm</h3><ul>
<li><p>你可以把它们导入到WebStorm设置中:</p>
<ul>
<li>下载<a href="https://github.com/johnpapa/angular-styleguide/blob/master/assets/webstorm-angular-file-template.settings.jar?raw=true" target="_blank" rel="noopener">WebStorm Angular file templates and snippets</a></li>
<li>打开WebStorm点击<code>File</code>菜单</li>
<li>选择<code>Import Settings</code>菜单选项</li>
<li>选择文件点击<code>OK</code></li>
<li>在JavaScript文件中输入下面的命令然后按下<code>TAB</code>键即可：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ng-c <span class="comment">// creates an Angular controller</span></span><br><span class="line">ng-f <span class="comment">// creates an Angular factory</span></span><br><span class="line">ng-m <span class="comment">// creates an Angular module</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Atom"><a href="#Atom" class="headerlink" title="Atom"></a>Atom</h3><ul>
<li><p>Angular片段遵循以下规范。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apm install angularjs-styleguide-snippets</span><br></pre></td></tr></table></figure>

<p>或</p>
<ul>
<li>打开Atom，打开包管理器(Packages -&gt; Settings View -&gt; Install Packages/Themes)</li>
<li>搜索’angularjs-styleguide-snippets’</li>
<li>点击’Install’ 进行安装</li>
</ul>
</li>
<li><p>JavaScript文件中输入以下命令后以<code>TAB</code>结束</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ngcontroller <span class="comment">// creates an Angular controller</span></span><br><span class="line">ngdirective <span class="comment">// creates an Angular directive</span></span><br><span class="line">ngfactory <span class="comment">// creates an Angular factory</span></span><br><span class="line">ngmodule <span class="comment">// creates an Angular module</span></span><br><span class="line">ngservice <span class="comment">// creates an Angular service</span></span><br><span class="line">ngfilter <span class="comment">// creates an Angular filter</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="Brackets"><a href="#Brackets" class="headerlink" title="Brackets"></a>Brackets</h3><ul>
<li><p>Angular代码片段遵循以下规范。</p>
<ul>
<li>下载<a href="assets/brackets-angular-snippets.yaml?raw=true">Brackets Angular snippets</a></li>
<li>拓展管理器( File &gt; Extension manager )</li>
<li>安装<a href="https://github.com/chuyik/brackets-snippets" target="_blank" rel="noopener">‘Brackets Snippets (by edc)’</a></li>
<li>Click the light bulb in brackets’ right gutter</li>
<li>Click <code>Settings</code> and then <code>Import</code></li>
<li>Choose the file and select to skip or override</li>
<li>Click <code>Start Import</code></li>
</ul>
</li>
<li><p>JavaScript文件中输入以下命令后以<code>TAB</code>结束</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// These are full file snippets containing an IIFE</span></span><br><span class="line">ngcontroller <span class="comment">// creates an Angular controller</span></span><br><span class="line">ngdirective  <span class="comment">// creates an Angular directive</span></span><br><span class="line">ngfactory    <span class="comment">// creates an Angular factory</span></span><br><span class="line">ngapp        <span class="comment">// creates an Angular module setter</span></span><br><span class="line">ngservice    <span class="comment">// creates an Angular service</span></span><br><span class="line">ngfilter     <span class="comment">// creates an Angular filter</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// These are partial snippets intended to chained</span></span><br><span class="line">ngmodule     <span class="comment">// creates an Angular module getter</span></span><br><span class="line">ngstate      <span class="comment">// creates an Angular UI Router state defintion</span></span><br><span class="line">ngconfig     <span class="comment">// defines a configuration phase function</span></span><br><span class="line">ngrun        <span class="comment">// defines a run phase function</span></span><br><span class="line">ngroute      <span class="comment">// creates an Angular routeProvider</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="vim"><a href="#vim" class="headerlink" title="vim"></a>vim</h3><ul>
<li><p>vim代码片段遵循以下规范。</p>
<ul>
<li>下载<a href="assets/vim-angular-snippets?raw=true">vim Angular代码段</a></li>
<li>设置<a href="https://github.com/Shougo/neosnippet.vim" target="_blank" rel="noopener">neosnippet.vim</a></li>
<li>粘贴到snippet路径下</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ngcontroller <span class="comment">// creates an Angular controller</span></span><br><span class="line">ngdirective  <span class="comment">// creates an Angular directive</span></span><br><span class="line">ngfactory    <span class="comment">// creates an Angular factory</span></span><br><span class="line">ngmodule     <span class="comment">// creates an Angular module</span></span><br><span class="line">ngservice    <span class="comment">// creates an Angular service</span></span><br><span class="line">ngfilter     <span class="comment">// creates an Angular filter</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="26-Yeoman-Generator"><a href="#26-Yeoman-Generator" class="headerlink" title="26. Yeoman Generator"></a>26. Yeoman Generator</h2><p>你可以使用<a href="http://jpapa.me/yohottowel" target="_blank" rel="noopener">HotTowel yeoman generator</a>来创建一个遵循本规范的Angular入门应用。</p>
<ol>
<li><p>安装generator-hottowel</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g generator-hottowel</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个新的文件夹并定位到它</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir myapp</span><br><span class="line">cd myapp</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行生成器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yo hottowel helloWorld</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="27-路由"><a href="#27-路由" class="headerlink" title="27. 路由"></a>27. 路由</h2><p>客户端路由对于在视图和很多小模板和指令组成的构成视图中创建导航是非常重要的。</p>
<ul>
<li><p>用<a href="http://angular-ui.github.io/ui-router/" target="_blank" rel="noopener">AngularUI Router</a>来做路由控制。</p>
<p><em>为什么？</em>：它包含了Angular路由的所有特性，并且增加了一些额外的特性，如嵌套路由和状态。</p>
<p><em>为什么？</em>：语法和Angular路由很像，很容易迁移到UI Router。</p>
</li>
<li><p>注意：你可以在运行期间使用<code>routerHelperProvider</code>配置跨文件状态</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// customers.routes.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'app.customers'</span>)</span><br><span class="line">    .run(appRun);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* @ngInject */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">appRun</span>(<span class="params">routerHelper</span>) </span>&#123;</span><br><span class="line">    routerHelper.configureStates(getStates());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getStates</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        &#123;</span><br><span class="line">            state: <span class="string">'customer'</span>,</span><br><span class="line">            config: &#123;</span><br><span class="line">                abstract: <span class="literal">true</span>,</span><br><span class="line">                template: <span class="string">'&lt;ui-view class="shuffle-animation"/&gt;'</span>,</span><br><span class="line">                url: <span class="string">'/customer'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routerHelperProvider.js</span></span><br><span class="line">angular</span><br><span class="line">    .module(<span class="string">'blocks.router'</span>)</span><br><span class="line">    .provider(<span class="string">'routerHelper'</span>, routerHelperProvider);</span><br><span class="line"></span><br><span class="line">routerHelperProvider.$inject = [<span class="string">'$locationProvider'</span>, <span class="string">'$stateProvider'</span>, <span class="string">'$urlRouterProvider'</span>];</span><br><span class="line"><span class="comment">/* @ngInject */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">routerHelperProvider</span>(<span class="params">$locationProvider, $stateProvider, $urlRouterProvider</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* jshint validthis:true */</span></span><br><span class="line">    <span class="keyword">this</span>.$<span class="keyword">get</span> = RouterHelper;</span><br><span class="line"></span><br><span class="line">    $locationProvider.html5Mode(true);</span><br><span class="line"></span><br><span class="line">    RouterHelper.$inject = ['$state'];</span><br><span class="line">    /* @ngInject */</span><br><span class="line">    function RouterHelper($state) &#123;</span><br><span class="line">        <span class="keyword">var</span> hasOtherwise = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> service = &#123;</span><br><span class="line">            configureStates: configureStates,</span><br><span class="line">            getStates: getStates</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line"></span><br><span class="line">        <span class="comment">///////////////</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">configureStates</span>(<span class="params">states, otherwisePath</span>) </span>&#123;</span><br><span class="line">            states.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">                $stateProvider.state(state.state, state.config);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">if</span> (otherwisePath &amp;&amp; !hasOtherwise) &#123;</span><br><span class="line">                hasOtherwise = <span class="literal">true</span>;</span><br><span class="line">                $urlRouterProvider.otherwise(otherwisePath);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">getStates</span>(<span class="params"></span>) </span>&#123; <span class="keyword">return</span> $state.get(); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Define routes for views in the module where they exist，Each module should contain the routes for the views in the module.</p>
<p><em>为什么？</em>：每个模块应该是独立的。</p>
<p><em>为什么？</em>：当删除或增加一个模块时，应用程序只包含指向现存视图的路由。（也就是说删除模块和增加模块都需更新路由）</p>
<p><em>为什么？</em>：这使得可以在不关心孤立的路由时很方便地启用或禁用应用程序的某些部分。</p>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="28-任务自动化"><a href="#28-任务自动化" class="headerlink" title="28. 任务自动化"></a>28. 任务自动化</h2><p>用<a href="http://gulpjs.com" target="_blank" rel="noopener">Gulp</a>或者<a href="http://gruntjs.com" target="_blank" rel="noopener">Grunt</a>来创建自动化任务。Gulp偏向于代码优先原则(code over configuration)而Grunt更倾向于配置优先原则(configuration over code)。我更倾向于使用gulp，因为gulp写起来比较简单。</p>
<blockquote>
<p>可以在我的<a href="http://jpapa.me/gulpps" target="_blank" rel="noopener">Gulp Pluralsight course</a>了解更多gulp和自动化任务的信息</p>
</blockquote>
<ul>
<li><p>用任务自动化在其它JavaScript文件之前列出所有模块的定义文件<code>*.module.js</code>。</p>
<p><em>为什么？</em>：Angular中，模块使用之前必须先注册。</p>
<p><em>为什么？*：带有特殊规则的模块命名，例如`</em>.module.js`，会让你很轻松地识别它们。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> clientApp = <span class="string">'./src/client/app/'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Always grab module files first</span></span><br><span class="line"><span class="keyword">var</span> files = [</span><br><span class="line">  clientApp + <span class="string">'**/*.module.js'</span>,</span><br><span class="line">  clientApp + <span class="string">'**/*.js'</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="29-Filters"><a href="#29-Filters" class="headerlink" title="29. Filters"></a>29. Filters</h2><ul>
<li><p>避免使用filters扫描一个复杂对象的所有属性，应该用filters来筛选选择的属性。</p>
<p><em>为什么？</em>：不恰当的使用会造成滥用并且会带来糟糕的性能问题，例如对一个复杂的对象使用过滤器。</p>
</li>
</ul>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<h2 id="30-Angular文档"><a href="#30-Angular文档" class="headerlink" title="30. Angular文档"></a>30. Angular文档</h2><p><a href="//docs.angularjs.org/api">Angular文档</a>。</p>
<p><strong><a href="#目录">返回顶部</a></strong></p>
<blockquote>
<p>reference: <a href="https://github.com/johnpapa/angular-styleguide/blob/master/a1/i18n/zh-CN.md" target="_blank" rel="noopener">https://github.com/johnpapa/angular-styleguide/blob/master/a1/i18n/zh-CN.md</a></p>
</blockquote>

      
    </div>
    
    <div>
      
        
      
    </div>

    <div>
      
        
      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Angular/" rel="tag">#Angular</a>
          
            <a href="/tags/Angular规范/" rel="tag">#Angular规范</a>
          
            <a href="/tags/规范指南/" rel="tag">#规范指南</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/07/13/160713git技巧汇总/" rel="next" title="git技巧汇总">
                <i class="fa fa-chevron-left"></i> git技巧汇总
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/01/161001http-server/" rel="prev" title="http-server介绍">
                http-server介绍 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          
  
  


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/default_avatar.jpg" alt="lsqy">
          <p class="site-author-name" itemprop="name">lsqy</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">77</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">97</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/lsqy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/lsqy93/" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/lsqy93" target="_blank" title="Twitter">
                  
                    <i class="fa fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/lsqyun" target="_blank" title="Weibo">
                  
                    <i class="fa fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa fa-globe fa-fw"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://developer.mozilla.org/zh-CN/#" title="MDN" target="_blank">MDN</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://nodejs.org/zh-cn/docs/" title="NodeJS" target="_blank">NodeJS</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://reactjs.cn/" title="React" target="_blank">React</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://cnodejs.org/" title="CNode" target="_blank">CNode</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#目录"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-单一职责"><span class="nav-number">2.</span> <span class="nav-text">1. 单一职责</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#规则一"><span class="nav-number">2.1.</span> <span class="nav-text">规则一</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-IIFE"><span class="nav-number">3.</span> <span class="nav-text">2. IIFE</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JavaScript闭包"><span class="nav-number">3.1.</span> <span class="nav-text">JavaScript闭包</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Modules"><span class="nav-number">4.</span> <span class="nav-text">3. Modules</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#避免命名冲突"><span class="nav-number">4.1.</span> <span class="nav-text">避免命名冲突</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#定义-aka-Setters"><span class="nav-number">4.2.</span> <span class="nav-text">定义(aka Setters)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getters"><span class="nav-number">4.3.</span> <span class="nav-text">Getters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Setting-vs-Getting"><span class="nav-number">4.4.</span> <span class="nav-text">Setting vs Getting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#命名函数-vs-匿名函数"><span class="nav-number">4.5.</span> <span class="nav-text">命名函数 vs 匿名函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Controllers"><span class="nav-number">5.</span> <span class="nav-text">4. Controllers</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#controllerAs在View中的语法"><span class="nav-number">5.1.</span> <span class="nav-text">controllerAs在View中的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#controllerAs在controller中的语法"><span class="nav-number">5.2.</span> <span class="nav-text">controllerAs在controller中的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#controllerAs-with-vm"><span class="nav-number">5.3.</span> <span class="nav-text">controllerAs with vm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#置顶绑定成员"><span class="nav-number">5.4.</span> <span class="nav-text">置顶绑定成员</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数声明隐藏实现细节"><span class="nav-number">5.5.</span> <span class="nav-text">函数声明隐藏实现细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#把Controller中的逻辑延迟到Service中"><span class="nav-number">5.6.</span> <span class="nav-text">把Controller中的逻辑延迟到Service中</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#保持Controller的专一性"><span class="nav-number">5.7.</span> <span class="nav-text">保持Controller的专一性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分配Controller"><span class="nav-number">5.8.</span> <span class="nav-text">分配Controller</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Services"><span class="nav-number">6.</span> <span class="nav-text">5. Services</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单例"><span class="nav-number">6.1.</span> <span class="nav-text">单例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Factories"><span class="nav-number">7.</span> <span class="nav-text">6. Factories</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#单一职责"><span class="nav-number">7.1.</span> <span class="nav-text">单一职责</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#单例-1"><span class="nav-number">7.2.</span> <span class="nav-text">单例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可访问的成员置顶"><span class="nav-number">7.3.</span> <span class="nav-text">可访问的成员置顶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#函数声明隐藏实现细节-1"><span class="nav-number">7.4.</span> <span class="nav-text">函数声明隐藏实现细节</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Data-Services"><span class="nav-number">8.</span> <span class="nav-text">7. Data Services</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#独立的数据调用"><span class="nav-number">8.1.</span> <span class="nav-text">独立的数据调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据调用返回一个Promise"><span class="nav-number">8.2.</span> <span class="nav-text">数据调用返回一个Promise</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-Directives"><span class="nav-number">9.</span> <span class="nav-text">8. Directives</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#一个directive一个文件"><span class="nav-number">9.1.</span> <span class="nav-text">一个directive一个文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#在directive中操作DOM"><span class="nav-number">9.2.</span> <span class="nav-text">在directive中操作DOM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#提供一个唯一的Directive前缀"><span class="nav-number">9.3.</span> <span class="nav-text">提供一个唯一的Directive前缀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#限制元素和属性"><span class="nav-number">9.4.</span> <span class="nav-text">限制元素和属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Directives和ControllerAs"><span class="nav-number">9.5.</span> <span class="nav-text">Directives和ControllerAs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-解决Controller的Promises"><span class="nav-number">10.</span> <span class="nav-text">9. 解决Controller的Promises</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Controller-Activation-Promises"><span class="nav-number">10.1.</span> <span class="nav-text">Controller Activation Promises</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Route-Resolve-Promises"><span class="nav-number">10.2.</span> <span class="nav-text">Route Resolve Promises</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-手动依赖注入"><span class="nav-number">11.</span> <span class="nav-text">10. 手动依赖注入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#压缩的不安全性"><span class="nav-number">11.1.</span> <span class="nav-text">压缩的不安全性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手动添加依赖"><span class="nav-number">11.2.</span> <span class="nav-text">手动添加依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#手动确定路由解析器依赖"><span class="nav-number">11.3.</span> <span class="nav-text">手动确定路由解析器依赖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-压缩和注释"><span class="nav-number">12.</span> <span class="nav-text">11. 压缩和注释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ng-annotate"><span class="nav-number">12.1.</span> <span class="nav-text">ng-annotate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Gulp或Grunt结合ng-annotate"><span class="nav-number">12.2.</span> <span class="nav-text">使用Gulp或Grunt结合ng-annotate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-异常处理"><span class="nav-number">13.</span> <span class="nav-text">12. 异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#修饰符"><span class="nav-number">13.1.</span> <span class="nav-text">修饰符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#异常捕获器"><span class="nav-number">13.2.</span> <span class="nav-text">异常捕获器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由错误"><span class="nav-number">13.3.</span> <span class="nav-text">路由错误</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-命名"><span class="nav-number">14.</span> <span class="nav-text">13. 命名</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命名原则"><span class="nav-number">14.1.</span> <span class="nav-text">命名原则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#功能文件命名"><span class="nav-number">14.2.</span> <span class="nav-text">功能文件命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试文件命名"><span class="nav-number">14.3.</span> <span class="nav-text">测试文件命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Controller命名"><span class="nav-number">14.4.</span> <span class="nav-text">Controller命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Controller命名后缀"><span class="nav-number">14.5.</span> <span class="nav-text">Controller命名后缀</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Factory命名"><span class="nav-number">14.6.</span> <span class="nav-text">Factory命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Directive组件命名"><span class="nav-number">14.7.</span> <span class="nav-text">Directive组件命名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块"><span class="nav-number">14.8.</span> <span class="nav-text">模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置"><span class="nav-number">14.9.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#路由"><span class="nav-number">14.10.</span> <span class="nav-text">路由</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14-应用程序结构的LIFT准则"><span class="nav-number">15.</span> <span class="nav-text">14. 应用程序结构的LIFT准则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LIFT"><span class="nav-number">15.1.</span> <span class="nav-text">LIFT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Locate"><span class="nav-number">15.2.</span> <span class="nav-text">Locate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Identify"><span class="nav-number">15.3.</span> <span class="nav-text">Identify</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Flat"><span class="nav-number">15.4.</span> <span class="nav-text">Flat</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#T-DRY（尽量坚持DRY）"><span class="nav-number">15.5.</span> <span class="nav-text">T-DRY（尽量坚持DRY）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15-应用程序结构"><span class="nav-number">16.</span> <span class="nav-text">15. 应用程序结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#总规范"><span class="nav-number">16.1.</span> <span class="nav-text">总规范</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Layout"><span class="nav-number">16.2.</span> <span class="nav-text">Layout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#按功能划分文件夹结构"><span class="nav-number">16.3.</span> <span class="nav-text">按功能划分文件夹结构</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16-模块化"><span class="nav-number">17.</span> <span class="nav-text">16. 模块化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#许多小的、独立的模块"><span class="nav-number">17.1.</span> <span class="nav-text">许多小的、独立的模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建一个App-Module"><span class="nav-number">17.2.</span> <span class="nav-text">创建一个App Module</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#保持App-Module的精简"><span class="nav-number">17.3.</span> <span class="nav-text">保持App Module的精简</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#功能区域就是模块"><span class="nav-number">17.4.</span> <span class="nav-text">功能区域就是模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#可重用的块就是模块"><span class="nav-number">17.5.</span> <span class="nav-text">可重用的块就是模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#模块依赖"><span class="nav-number">17.6.</span> <span class="nav-text">模块依赖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17-启动逻辑"><span class="nav-number">18.</span> <span class="nav-text">17. 启动逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置-1"><span class="nav-number">18.1.</span> <span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行代码块"><span class="nav-number">18.2.</span> <span class="nav-text">运行代码块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18-Angular-包装服务"><span class="nav-number">19.</span> <span class="nav-text">18. Angular $包装服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#document和-window"><span class="nav-number">19.1.</span> <span class="nav-text">$document和$window</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#timeout和-interval"><span class="nav-number">19.2.</span> <span class="nav-text">$timeout和$interval</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19-测试"><span class="nav-number">20.</span> <span class="nav-text">19. 测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用故事来编写测试"><span class="nav-number">20.1.</span> <span class="nav-text">用故事来编写测试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试库"><span class="nav-number">20.2.</span> <span class="nav-text">测试库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试运行器"><span class="nav-number">20.3.</span> <span class="nav-text">测试运行器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Stubbing和Spying"><span class="nav-number">20.4.</span> <span class="nav-text">Stubbing和Spying</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Headless-Browser"><span class="nav-number">20.5.</span> <span class="nav-text">Headless Browser</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码分析"><span class="nav-number">20.6.</span> <span class="nav-text">代码分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#对测试降低全局JSHint规则"><span class="nav-number">20.7.</span> <span class="nav-text">对测试降低全局JSHint规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#组织测试"><span class="nav-number">20.8.</span> <span class="nav-text">组织测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20-动画"><span class="nav-number">21.</span> <span class="nav-text">20. 动画</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用法"><span class="nav-number">21.1.</span> <span class="nav-text">用法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sub-Second"><span class="nav-number">21.2.</span> <span class="nav-text">Sub Second</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#animate-css"><span class="nav-number">21.3.</span> <span class="nav-text">animate.css</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21-注释"><span class="nav-number">22.</span> <span class="nav-text">21. 注释</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#jsDoc"><span class="nav-number">22.1.</span> <span class="nav-text">jsDoc</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22-JS-Hint"><span class="nav-number">23.</span> <span class="nav-text">22. JS Hint</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用一个Options文件"><span class="nav-number">23.1.</span> <span class="nav-text">使用一个Options文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23-JSCS"><span class="nav-number">24.</span> <span class="nav-text">23. JSCS</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用一个Options文件"><span class="nav-number">24.1.</span> <span class="nav-text">用一个Options文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24-常量"><span class="nav-number">25.</span> <span class="nav-text">24. 常量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25-文件模板和片段"><span class="nav-number">26.</span> <span class="nav-text">25. 文件模板和片段</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Sublime-Text"><span class="nav-number">26.1.</span> <span class="nav-text">Sublime Text</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Visual-Studio"><span class="nav-number">26.2.</span> <span class="nav-text">Visual Studio</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebStorm"><span class="nav-number">26.3.</span> <span class="nav-text">WebStorm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Atom"><span class="nav-number">26.4.</span> <span class="nav-text">Atom</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Brackets"><span class="nav-number">26.5.</span> <span class="nav-text">Brackets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vim"><span class="nav-number">26.6.</span> <span class="nav-text">vim</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26-Yeoman-Generator"><span class="nav-number">27.</span> <span class="nav-text">26. Yeoman Generator</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#27-路由"><span class="nav-number">28.</span> <span class="nav-text">27. 路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#28-任务自动化"><span class="nav-number">29.</span> <span class="nav-text">28. 任务自动化</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#29-Filters"><span class="nav-number">30.</span> <span class="nav-text">29. Filters</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#30-Angular文档"><span class="nav-number">31.</span> <span class="nav-text">30. Angular文档</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy;  2014 - 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lsqy</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io" rel="external nofollow">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
  <a href="javascript:;" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;border-bottom: none;font-size: 12px;position: relative;top: 7px;left: 4px;">
    <img src="https://img.lsqy.tech/hexo/beian.png" style="float:left;width: 14px;margin-top: 2px;">
    <p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">京公网安备 11010502038173号</p>
  </a>
</div>

        

<div class="busuanzi-count" style="width: 0px; height: 0px;overflow: hidden;">

  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv" style="visibility: hidden;"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv" style="visibility: hidden;"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
      
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'lsqy';
      var disqus_identifier = '2016/09/15/160915Angular规范/';
      var disqus_title = 'Angular规范';
      var disqus_url = 'https://lsqy.tech/2016/09/15/160915Angular规范/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  
<script type="text/javascript" async>
  !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=window.location.href,o=document.referrer;if(!e.test(r)){var n="//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var t=new Image;t.src=n}}(window);
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
</script>


</body>
</html>
